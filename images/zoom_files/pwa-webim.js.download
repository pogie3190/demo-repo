(this.webpackJsonpzoom=this.webpackJsonpzoom||[]).push([[6],{15:function(e,t,n){(function(e){!function(t){"use strict";var n,i,r,o="WEB_SESSION_EXPIRED_ERROR";function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}t.WebimEventType=void 0,(n=t.WebimEventType||(t.WebimEventType={})).OnlineMembers="OnlineMembers",n.PresenceChange="PresenceChange",n.ServerGroups="ServerGroups",n.GroupChange="GroupChange",n.RosterChange="RosterChange",n.RosterBlocklist="RosterBlocklist",n.MessageChange="Message",n.RecentChat="RecentChat",n.IqResultChange="Response",n.VcardChange="VcardChange",n.RoomChange="RoomChange",n.ConnectionStatusChange="ConnectionStatusChange",n.DurationChange="DurationChange",n.DeviceListChange="DeviceListChange",n.InviteContactChange="InviteContactChange",n.InviteContactSyncMessage="InviteContactSyncMessage",n.LoginOtherDevice="LoginOtherDevice",t.WebimLogLevel=void 0,(i=t.WebimLogLevel||(t.WebimLogLevel={}))[i.DEBUG=0]="DEBUG",i[i.INFO=1]="INFO",i[i.WARN=2]="WARN",i[i.ERROR=3]="ERROR",i[i.NONE=4]="NONE",t.WebimModuleName=void 0,(r=t.WebimModuleName||(t.WebimModuleName={})).vcard="vcard",r.presence="presence",r.roster="roster",r.connection="connection",r.message="message",r.xms="xms",r.room="room","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;var c,u,l,d,h,m,f=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(function(e){var t={exports:{}};return function(e,t){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(e,t,n){(function(i){function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a,c,u,l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n,i){"object"===d(t)&&void 0!==e?i(t):(c=[t],void 0!==(u="function"==typeof(a=i)?a.apply(t,c):a)&&(e.exports=u))}(0,(function(e){function t(){if("undefined"==typeof document)try{return(new(0,n(!function(){var e=new Error('Cannot find module "@xmldom/xmldom"');throw e.code="MODULE_NOT_FOUND",e}()).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "@xmldom/xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){var e=function(){for(var e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}();return e.appendChild(e.createElement("strophe")),e}return document.implementation.createDocument("jabber:client","strophe",null)}function a(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,i,r,o,s,a,l,d,h=new Array(80),p=1732584193,g=-271733879,v=-1732584194,_=271733878,y=-1009589776;for(n=0;n<e.length;n+=16){for(o=p,s=g,a=v,l=_,d=y,i=0;i<80;i++)h[i]=i<16?e[n+i]:f(h[i-3]^h[i-8]^h[i-14]^h[i-16],1),r=m(m(f(p,5),c(i,g,v,_)),m(m(y,h[i]),u(i))),y=_,_=v,v=f(g,30),g=p,p=r;p=m(p,o),g=m(g,s),v=m(v,a),_=m(_,l),y=m(y,d)}return[p,g,v,_,y]}function c(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function u(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function h(e,t){var n=p(e);n.length>16&&(n=a(n,8*e.length));for(var i=new Array(16),r=new Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var s=a(i.concat(p(t)),512+8*t.length);return a(r.concat(s),672)}function m(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){return e<<t|e>>>32-t}function p(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function g(e){for(var t,n,i="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?i+="=":i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return i}function v(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function _(e){var t=J.indexOf(e);return t<0?void 0:t}function y(e){if(e>=0&&e<64)return V[e]}function N(e,t){return new Q.Builder(e,t)}function b(e){return new Q.Builder("message",e)}function C(e){return new Q.Builder("iq",e)}function T(e){return new Q.Builder("presence",e)}var I=void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},S=function(){var e=I.WebSocket;if(void 0===e)try{e=n(!function(){var e=new Error('Cannot find module "ws"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}(),E=function(){var e=I.DOMParser;if(void 0===e)try{e=n(!function(){var e=new Error('Cannot find module "@xmldom/xmldom"');throw e.code="MODULE_NOT_FOUND",e}()).DOMParser}catch(e){throw new Error('You must install the "@xmldom/xmldom" package to use Strophe in nodejs.')}return e}(),x=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},O=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},R=function(e,t,n,i,r,o){return x(function(e,t){return e<<t|e>>>32-t}(x(x(t,e),x(i,o)),r),n)},w=function(e,t,n,i,r,o,s){return R(t&n|~t&i,e,t,r,o,s)},A=function(e,t,n,i,r,o,s){return R(t&i|n&~i,e,t,r,o,s)},M=function(e,t,n,i,r,o,s){return R(t^n^i,e,t,r,o,s)},k=function(e,t,n,i,r,o,s){return R(n^(t|~i),e,t,r,o,s)},D=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,r=-1732584194,o=271733878,s=void 0,a=void 0,c=void 0,u=void 0,l=0;l<e.length;l+=16)s=n,a=i,c=r,u=o,n=w(n,i,r,o,e[l+0],7,-680876936),o=w(o,n,i,r,e[l+1],12,-389564586),r=w(r,o,n,i,e[l+2],17,606105819),i=w(i,r,o,n,e[l+3],22,-1044525330),n=w(n,i,r,o,e[l+4],7,-176418897),o=w(o,n,i,r,e[l+5],12,1200080426),r=w(r,o,n,i,e[l+6],17,-1473231341),i=w(i,r,o,n,e[l+7],22,-45705983),n=w(n,i,r,o,e[l+8],7,1770035416),o=w(o,n,i,r,e[l+9],12,-1958414417),r=w(r,o,n,i,e[l+10],17,-42063),i=w(i,r,o,n,e[l+11],22,-1990404162),n=w(n,i,r,o,e[l+12],7,1804603682),o=w(o,n,i,r,e[l+13],12,-40341101),r=w(r,o,n,i,e[l+14],17,-1502002290),i=w(i,r,o,n,e[l+15],22,1236535329),n=A(n,i,r,o,e[l+1],5,-165796510),o=A(o,n,i,r,e[l+6],9,-1069501632),r=A(r,o,n,i,e[l+11],14,643717713),i=A(i,r,o,n,e[l+0],20,-373897302),n=A(n,i,r,o,e[l+5],5,-701558691),o=A(o,n,i,r,e[l+10],9,38016083),r=A(r,o,n,i,e[l+15],14,-660478335),i=A(i,r,o,n,e[l+4],20,-405537848),n=A(n,i,r,o,e[l+9],5,568446438),o=A(o,n,i,r,e[l+14],9,-1019803690),r=A(r,o,n,i,e[l+3],14,-187363961),i=A(i,r,o,n,e[l+8],20,1163531501),n=A(n,i,r,o,e[l+13],5,-1444681467),o=A(o,n,i,r,e[l+2],9,-51403784),r=A(r,o,n,i,e[l+7],14,1735328473),i=A(i,r,o,n,e[l+12],20,-1926607734),n=M(n,i,r,o,e[l+5],4,-378558),o=M(o,n,i,r,e[l+8],11,-2022574463),r=M(r,o,n,i,e[l+11],16,1839030562),i=M(i,r,o,n,e[l+14],23,-35309556),n=M(n,i,r,o,e[l+1],4,-1530992060),o=M(o,n,i,r,e[l+4],11,1272893353),r=M(r,o,n,i,e[l+7],16,-155497632),i=M(i,r,o,n,e[l+10],23,-1094730640),n=M(n,i,r,o,e[l+13],4,681279174),o=M(o,n,i,r,e[l+0],11,-358537222),r=M(r,o,n,i,e[l+3],16,-722521979),i=M(i,r,o,n,e[l+6],23,76029189),n=M(n,i,r,o,e[l+9],4,-640364487),o=M(o,n,i,r,e[l+12],11,-421815835),r=M(r,o,n,i,e[l+15],16,530742520),i=M(i,r,o,n,e[l+2],23,-995338651),n=k(n,i,r,o,e[l+0],6,-198630844),o=k(o,n,i,r,e[l+7],10,1126891415),r=k(r,o,n,i,e[l+14],15,-1416354905),i=k(i,r,o,n,e[l+5],21,-57434055),n=k(n,i,r,o,e[l+12],6,1700485571),o=k(o,n,i,r,e[l+3],10,-1894986606),r=k(r,o,n,i,e[l+10],15,-1051523),i=k(i,r,o,n,e[l+1],21,-2054922799),n=k(n,i,r,o,e[l+8],6,1873313359),o=k(o,n,i,r,e[l+15],10,-30611744),r=k(r,o,n,i,e[l+6],15,-1560198380),i=k(i,r,o,n,e[l+13],21,1309151649),n=k(n,i,r,o,e[l+4],6,-145523070),o=k(o,n,i,r,e[l+11],10,-1120210379),r=k(r,o,n,i,e[l+2],15,718787259),i=k(i,r,o,n,e[l+9],21,-343485551),n=x(n,s),i=x(i,a),r=x(r,c),o=x(o,u);return[n,i,r,o]},q={hexdigest:function(e){return function(e){for(var t="0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n}(D(O(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(D(O(e),8*e.length))}},L=function(){function e(t,n,i){s(this,e),this.mechname=t,this.isClientFirst=n,this.priority=i}return l(e,[{key:"test",value:function(){return!0}},{key:"onStart",value:function(e){this._connection=e}},{key:"onChallenge",value:function(e,t){throw new Error("You should implement challenge handling!")}},{key:"clientChallenge",value:function(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}},{key:"onFailure",value:function(){this._connection=null}},{key:"onSuccess",value:function(){this._connection=null}}]),e}(),P=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ANONYMOUS",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"test",value:function(e){return null===e.authcid}}]),t}(L),H=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EXTERNAL",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"onChallenge",value:function(e){return e.authcid===e.authzid?"":e.authzid}}]),t}(L),j=function(e){var t,n,i="",r=e.length;for(t=0;t<r;t++)(n=e.charCodeAt(t))>=0&&n<=127?i+=e.charAt(t):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},B=function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",i="",r="",o=e[t],s="object"===(void 0===o?"undefined":d(o)),a=escape(unescape(s?o.value:o));s&&(n=o.expires?";expires="+o.expires:"",i=o.domain?";domain="+o.domain:"",r=o.path?";path="+o.path:""),document.cookie=t+"="+a+n+i+r}},F=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OAUTHBEARER",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"test",value:function(e){return null!==e.pass}},{key:"onChallenge",value:function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="\x01",t+="auth=Bearer ",t+=e.pass,t+="\x01",j(t+="\x01")}}]),t}(L),z=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PLAIN",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"test",value:function(e){return null!==e.authcid}},{key:"onChallenge",value:function(e){var t=e.authcid,n=e.authzid,i=e.domain,r=e.pass;if(!i)throw new Error("SASLPlain onChallenge: domain is not defined!");var o=n!==t+"@"+i?n:"";return o+="\0",o+=t,o+="\0",j(o+=r)}}]),t}(L),W={b64_hmac_sha1:function(e,t){return g(h(e,t))},b64_sha1:function(e){return g(a(p(e),8*e.length))},binb2str:v,core_hmac_sha1:h,str_hmac_sha1:function(e,t){return v(h(e,t))},str_sha1:function(e){return v(a(p(e),8*e.length))}},U=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-1",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"test",value:function(e){return null!==e.authcid}},{key:"onChallenge",value:function(e,t){for(var n=void 0,i=void 0,r=void 0,o=void 0,s=void 0,a=void 0,c=void 0,u=void 0,l="c=biws,",d=e._sasl_data["client-first-message-bare"]+","+t+",",h=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;t.match(m);){var f=t.match(m);switch(t=t.replace(f[0],""),f[1]){case"r":n=f[2];break;case"s":i=f[2];break;case"i":r=f[2]}}if(n.slice(0,h.length)!==h)return e._sasl_data={},e._sasl_failure_cb();d+=l+="r="+n,i=atob(i),i+="\0\0\0\x01";var p=j(e.pass);for(o=a=W.core_hmac_sha1(p,i),c=1;c<r;c++){for(s=W.core_hmac_sha1(p,W.binb2str(a)),u=0;u<5;u++)o[u]^=s[u];a=s}o=W.binb2str(o);var g=W.core_hmac_sha1(o,"Client Key"),v=W.str_hmac_sha1(o,"Server Key"),_=W.core_hmac_sha1(W.str_sha1(W.binb2str(g)),d);for(e._sasl_data["server-signature"]=W.b64_hmac_sha1(v,d),u=0;u<5;u++)g[u]^=_[u];return l+",p="+btoa(W.binb2str(g))}},{key:"clientChallenge",value:function(e,t){var n=t||q.hexdigest(""+1234567890*Math.random()),i="n="+j(e.authcid);return i+=",r=",i+=n,e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=i,"n,,"+i}}]),t}(L),G=function(e){function t(){s(this,t);var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X-OAUTH2",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i))}return o(t,e),l(t,[{key:"test",value:function(e){return null!==e.pass}},{key:"onChallenge",value:function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,j(t)}}]),t}(L),J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X={atob:function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=""+e).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;for(var t="",n=0,i=0,r=0;r<e.length;r++)n<<=6,n|=_(e[r]),24===(i+=6)&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=i=0);return 12===i?(n>>=4,t+=String.fromCharCode(n)):18===i&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t},btoa:function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=void 0;for(e=""+e,t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;var n="";for(t=0;t<e.length;t+=3){var i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(t)>>2,i[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(i[1]|=e.charCodeAt(t+1)>>4,i[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(i[2]|=e.charCodeAt(t+2)>>6,i[3]=63&e.charCodeAt(t+2));for(var r=0;r<i.length;r++)void 0===i[r]?n+="=":n+=y(i[r])}return n}},Q={VERSION:"1.5.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},ACTION:{ROOMS_CALLBACK_STATE:1,ROOMS_DETAIL_CALLBACK_STATE:2,ROOMS_CREATE_CALLBACK:3,ROSTER_VERSION_CB:4,ROSTER_ITEMS_CB:5,ROSTER_ITEM_DEL_CB:6,ROSTER_ITEM_ADD_CB:7,WEBINAR_MEMBER_LIST:8,WEBINAR_MEMBER_ADD:9,WEBINAR_MEMBER_REMOVE:10,WEBINAR_MEMBER_CHANGER:11,WEBINAR_MEMBER_RENAME:12},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<Q.XHTML.tags.length;t++)if(e===Q.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==Q.XHTML.attributes[e]&&Q.XHTML.attributes[e].length>0)for(var n=0;n<Q.XHTML.attributes[e].length;n++)if(t===Q.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<Q.XHTML.css.length;t++)if(e===Q.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){Q.NS[e]=t},forEachChild:function(e,t,n){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];r.nodeType!==Q.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,xmlGenerator:function(){return Q._xmlGenerator||(Q._xmlGenerator=t()),Q._xmlGenerator},xmlElement:function(e){if(!e)return null;for(var t=Q.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)if("string"==typeof i||"number"==typeof i)t.appendChild(Q.xmlTextNode(i));else if("object"===(void 0===i?"undefined":d(i))&&"function"==typeof i.sort)for(var r=0;r<i.length;r++){var o=i[r];"object"===(void 0===o?"undefined":d(o))&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&t.setAttribute(o[0],o[1])}else if("object"===(void 0===i?"undefined":d(i)))for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&void 0!==i[s]&&null!==i[s]&&t.setAttribute(s,i[s])}return t},xmlescape:function(e){return(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return Q.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t=void 0;return E?t=(new E).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===Q.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===Q.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return Q.xmlescape(t)},copyElement:function(e){var t=void 0;if(e.nodeType===Q.ElementType.NORMAL){t=Q.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var i=0;i<e.childNodes.length;i++)t.appendChild(Q.copyElement(e.childNodes[i]))}else e.nodeType===Q.ElementType.TEXT&&(t=Q.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t=void 0;if(e.nodeType===Q.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(Q.XHTML.validTag(n))try{t=Q.xmlElement(n);for(var i=0;i<Q.XHTML.attributes[n].length;i++){var r=Q.XHTML.attributes[n][i],o=e.getAttribute(r);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===r&&"object"===(void 0===o?"undefined":d(o))&&void 0!==o.cssText&&(o=o.cssText),"style"===r){for(var s=[],a=o.split(";"),c=0;c<a.length;c++){var u=a[c].split(":"),l=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Q.XHTML.validCSS(l)){var h=u[1].replace(/^\s*/,"").replace(/\s*$/,"");s.push(l+": "+h)}}s.length>0&&(o=s.join("; "),t.setAttribute(r,o))}else t.setAttribute(r,o)}for(var m=0;m<e.childNodes.length;m++)t.appendChild(Q.createHtml(e.childNodes[m]))}catch(e){t=Q.xmlTextNode("")}else{t=Q.xmlGenerator().createDocumentFragment();for(var f=0;f<e.childNodes.length;f++)t.appendChild(Q.createHtml(e.childNodes[f]))}}else if(e.nodeType===Q.ElementType.FRAGMENT){t=Q.xmlGenerator().createDocumentFragment();for(var p=0;p<e.childNodes.length;p++)t.appendChild(Q.createHtml(e.childNodes[p]))}else e.nodeType===Q.ElementType.TEXT&&(t=Q.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=Q.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){if(!e)return null;var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&Q.fatal(e.stack),e.sourceURL?Q.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?Q.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):Q.fatal("error: "+e.message)},log:function(e,t){var n;e===this.LogLevel.FATAL&&(null===(n=console)||void 0===n||n.error(t))},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(e.attributes.length).keys())).map((function(t){return e.attributes[t].nodeName}));t.sort();var n=t.reduce((function(t,n){return t+" "+n+'="'+Q.xmlescape(e.attributes.getNamedItem(n).value)+'"'}),"<"+e.nodeName);if(e.childNodes.length>0){n+=">";for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeType){case Q.ElementType.NORMAL:n+=Q.serialize(r);break;case Q.ElementType.TEXT:n+=Q.xmlescape(r.nodeValue);break;case Q.ElementType.CDATA:n+="<![CDATA["+r.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){Q._connectionPlugins[e]=t}};Q.Builder=function(){function e(t,n){s(this,e),"presence"!==t&&"message"!==t&&"iq"!==t||(n&&!n.xmlns?n.xmlns=Q.NS.CLIENT:n||(n={xmlns:Q.NS.CLIENT})),this.nodeTree=Q.xmlElement(t,n),this.node=this.nodeTree}return l(e,[{key:"tree",value:function(){return this.nodeTree}},{key:"toString",value:function(){return Q.serialize(this.nodeTree)}},{key:"up",value:function(){return this.node=this.node.parentNode,this}},{key:"root",value:function(){return this.node=this.nodeTree,this}},{key:"attrs",value:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}},{key:"c",value:function(e,t,n){var i=Q.xmlElement(e,t,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this}},{key:"cnode",value:function(e){var t=void 0,n=Q.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var i=t?n.importNode(e,!0):Q.copyElement(e);return this.node.appendChild(i),this.node=i,this}},{key:"t",value:function(e){var t=Q.xmlTextNode(e);return this.node.appendChild(t),this}},{key:"h",value:function(e){var t=Q.xmlGenerator().createElement("body");t.innerHTML=e;for(var n=Q.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}]),e}(),Q.Handler=function(e,t,n,i,r,o,s){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=r,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(Q.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?Q.getBareJidFromJid(o):null:this.from=o,this.user=!0},Q.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(Q.forEachChild(e,null,(function(e){t.getNamespace(e)===t.ns&&(n=!0)})),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=Q.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!Q.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw Q._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},Q.TimedHandler=function(){function e(t,n){s(this,e),this.period=t,this.handler=n,this.lastCalled=(new Date).getTime(),this.user=!0}return l(e,[{key:"run",value:function(){return this.lastCalled=(new Date).getTime(),this.handler()}},{key:"reset",value:function(){this.lastCalled=(new Date).getTime()}},{key:"toString",value:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}}]),e}(),Q.Connection=function(){function e(t,n){var i=this;for(var r in s(this,e),this.service=t,this.options=n||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.deviceName=n.deviceName||"",this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return i._onIdle()}),100),B(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new Q.Handler((function(e){return i.send(C({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:Q.NS.STANZAS}))}),null,"iq",["get","set"]),Q._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Q._connectionPlugins,r)){var o=function(){};o.prototype=Q._connectionPlugins[r],this[r]=new o,this[r].init(this)}}return l(e,[{key:"setProtocol",value:function(){var e=this.options.protocol||"";this.options.worker?this._proto=new Q.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new Q.Websocket(this):this._proto=new Q.Bosh(this)}},{key:"reset",value:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}},{key:"pause",value:function(){this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"getUniqueId",value:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}},{key:"addProtocolErrorHandler",value:function(e,t,n){this.protocolErrorHandlers[e][t]=n}},{key:"connect",value:function(e,t,n,i,r,o,s,a,c,u){var l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3e3;this.jid=e,this.authzid=Q.getBareJidFromJid(this.jid),this.chatoption=n,this.groups=i,this.version=r,this.authcid=u||Q.getNodeFromJid(this.jid),this.pass=t,this.connect_callback=o,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=l,this.domain=Q.getDomainFromJid(this.jid),this._changeConnectStatus(Q.Status.CONNECTING,null),this._proto._connect(s,a,c)}},{key:"attach",value:function(e,t,n,i,r,o,s){if(this._proto._attach)return this._proto._attach(e,t,n,i,r,o,s);var a=new Error('The "attach" method is not available for your connection protocol');throw a.name="StropheSessionError",a}},{key:"restore",value:function(e,t,n,i,r){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,i,r)}},{key:"_sessionCachingSupported",value:function(){if(this._proto instanceof Q.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}},{key:"xmlInput",value:function(e){}},{key:"xmlOutput",value:function(e){}},{key:"rawInput",value:function(e){}},{key:"rawOutput",value:function(e){}},{key:"nextValidRid",value:function(e){}},{key:"send",value:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}},{key:"flush",value:function(){clearTimeout(this._idleTimeout),this._onIdle()}},{key:"sendPresence",value:function(e,t,n,i){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler((function(e){o&&r.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,s);i&&(o=this.addTimedHandler(i,(function(){return r.deleteHandler(a),n&&n(null),!1})))}return this.send(e),s}},{key:"sendIQ",value:function(e,t,n,i){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler((function(e){o&&r.deleteTimedHandler(o);var i=e.getAttribute("type");if("result"===i)t&&t(e);else{if("error"!==i){var s=new Error("Got bad IQ type of "+i);throw s.name="StropheError",s}n&&n(e)}}),null,"iq",["error","result"],s);i&&(o=this.addTimedHandler(i,(function(){return r.deleteHandler(a),n&&n(null),!1})))}return this.send(e),s}},{key:"_queueData",value:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)}},{key:"_sendRestart",value:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return e._onIdle()}),100)}},{key:"addTimedHandler",value:function(e,t){var n=new Q.TimedHandler(e,t);return this.addTimeds.push(n),n}},{key:"deleteTimedHandler",value:function(e){this.removeTimeds.push(e)}},{key:"addHandler",value:function(e,t,n,i,r,o,s){var a=new Q.Handler(e,t,n,i,r,o,s);return this.addHandlers.push(a),a}},{key:"deleteHandler",value:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}},{key:"registerSASLMechanisms",value:function(e){var t=this;this.mechanisms={},(e=e||[Q.SASLAnonymous,Q.SASLExternal,Q.SASLOAuthBearer,Q.SASLXOAuth2,Q.SASLPlain,Q.SASLSHA1]).forEach((function(e){return t.registerSASLMechanism(e)}))}},{key:"registerSASLMechanism",value:function(e){var t=new e;this.mechanisms[t.mechname]=t}},{key:"disconnect",value:function(e){if(this._changeConnectStatus(Q.Status.DISCONNECTING,e),e?Q.warn("Disconnect was called because: "+e):Q.info("Disconnect was called"),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=T({xmlns:Q.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else Q.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}},{key:"_changeConnectStatus",value:function(e,t,n){for(var i in Q._connectionPlugins)if(Object.prototype.hasOwnProperty.call(Q._connectionPlugins,i)){var r=this[i];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){Q.error(i+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){Q._handleError(e),Q.error("User connection callback caused an exception: "+e)}}},{key:"_doDisconnect",value:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),Q.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(Q.Status.DISCONNECTED,e),this.connected=!1}},{key:"_dataRecv",value:function(e,t){var n=this,i=this._proto._reqToData(e);if(null!==i){for(this.xmlInput!==Q.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==Q.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(Q.serialize(i)));this.removeHandlers.length>0;){var r=this.removeHandlers.pop(),o=this.handlers.indexOf(r);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var s=i.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=i.getAttribute("condition"),c=i.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(Q.Status.CONNFAIL,a)):this._changeConnectStatus(Q.Status.CONNFAIL,Q.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}Q.forEachChild(i,null,(function(e){var t=[];n.handlers=n.handlers.reduce((function(i,r){try{!r.isMatch(e)||!n.authenticated&&r.user?i.push(r):(r.run(e)&&i.push(r),t.push(r))}catch(e){Q.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return i}),[]),!t.length&&n.iqFallbackHandler.isMatch(e)&&n.iqFallbackHandler.run(e)}))}}},{key:"_connect_cb",value:function(e,t,n){var i=this;Q.debug("_connect_cb was called"),this.connected=!0;var r=void 0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==Q.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(Q.Status.CONNFAIL,Q.ErrorCondition.BAD_FORMAT),this._doDisconnect(Q.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==Q.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==Q.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(Q.serialize(r))),this._proto._connect_cb(r)!==Q.Status.CONNFAIL)){if(!(r.getElementsByTagNameNS?r.getElementsByTagNameNS(Q.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0))return void this._proto._no_auth_received(t);if(0===Array.from(r.getElementsByTagName("mechanism")).map((function(e){return i.mechanisms[e.textContent]})).filter((function(e){return e})).length&&0===r.getElementsByTagName("auth").length)return void this._proto._no_auth_received(t);if(!1!==this.do_authentication){var o=Q.getResourceFromJid(this.jid);o||(o=Q.Resource);var s="{"+this.getUniqueId("sendIQ")+"}",a=Q._Conection_Id_,c=C({id:s,type:"set",xmlns:Q.NS.CLIENT}).c("query",{xmlns:Q.NS.AUTH}).c("username").t(Q.getNodeFromJid(this.jid)).up().c("password").t(this.pass).up().c("resource").t(o).up().c("option").t(this.chatoption).up().c("deviceid").t(a).up().c("dname").t(this.deviceName).up().c("force").t("1").up().c("dtype").t("0").up().c("cv").t(this.version).up();null!=this.groups&&c.c("groupids").t(this.groups).up(),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,s),this.send(c.tree())}}}},{key:"sortMechanismsByPriority",value:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,i=t+1;i<e.length;++i)e[i].priority>e[n].priority&&(n=i);if(n!==t){var r=e[t];e[t]=e[n],e[n]=r}}return e}},{key:"authenticate",value:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}},{key:"_attemptSASLAuth",value:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);var i=N("auth",{xmlns:Q.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.clientChallenge(this);i.t(X.btoa(r))}this.send(i.tree()),t=!0;break}return t}},{key:"_sasl_challenge_cb",value:function(e){var t=X.atob(Q.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),i=N("response",{xmlns:Q.NS.SASL});return""!==n&&i.t(X.btoa(n)),this.send(i.tree()),!0}},{key:"_attemptLegacyAuth",value:function(){null===Q.getNodeFromJid(this.jid)?(this._changeConnectStatus(Q.Status.CONNFAIL,Q.ErrorCondition.MISSING_JID_NODE),this.disconnect(Q.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(Q.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(C({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Q.NS.AUTH}).c("username",{}).t(Q.getNodeFromJid(this.jid)).tree()))}},{key:"_onLegacyAuthIQResult",value:function(e){var t=C({type:"set",id:"_auth_2"}).c("query",{xmlns:Q.NS.AUTH}).c("username",{}).t(Q.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return Q.getResourceFromJid(this.jid)||(this.jid=Q.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(Q.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}},{key:"_sasl_success_cb",value:function(e){var t=this;if(this._sasl_data["server-signature"]){var n=void 0,i=X.atob(Q.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===i[1]&&(n=i[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}Q.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var r=[],o=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._onStreamFeaturesAfterSASL(n),!1};return r.push(this._addSysHandler((function(e){return o(r,e)}),null,"stream:features",null,null)),r.push(this._addSysHandler((function(e){return o(r,e)}),Q.NS.STREAM,"features",null,null)),this._sendRestart(),!1}},{key:"_onStreamFeaturesAfterSASL",value:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(Q.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(Q.Status.AUTHFAIL,null),!1)}},{key:"bind",value:function(){if(this.do_bind){this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");var e=Q.getResourceFromJid(this.jid);e?this.send(C({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Q.NS.BIND}).c("resource",{}).t(e).tree()):this.send(C({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Q.NS.BIND}).tree())}else Q.log(Q.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false')}},{key:"_onResourceBindResultIQ",value:function(e){if("error"===e.getAttribute("type")){Q.warn("Resource binding failed.");var t=void 0;return e.getElementsByTagName("conflict").length>0&&(t=Q.ErrorCondition.CONFLICT),this._changeConnectStatus(Q.Status.AUTHFAIL,t,e),!1}var n=e.getElementsByTagName("bind");if(!(n.length>0))return Q.warn("Resource binding failed."),this._changeConnectStatus(Q.Status.AUTHFAIL,null,e),!1;var i=n[0].getElementsByTagName("jid");i.length>0&&(this.authenticated=!0,this.jid=Q.getText(i[0]),this.do_session?this._establishSession():this._changeConnectStatus(Q.Status.CONNECTED,null))}},{key:"_establishSession",value:function(){if(!this.do_session)throw new Error("Strophe.Connection.prototype._establishSession called but apparently "+Q.NS.SESSION+" wasn't advertised by the server");this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(C({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Q.NS.SESSION}).tree())}},{key:"_onSessionResultIQ",value:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(Q.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,Q.warn("Session creation failed."),this._changeConnectStatus(Q.Status.AUTHFAIL,null,e),!1;return!1}},{key:"_sasl_failure_cb",value:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(Q.Status.AUTHFAIL,null,e),!1}},{key:"_auth2_cb",value:function(e){if("result"===e.getAttribute("type")){var t=e.getElementsByTagName("query");if(this.authenticated=!0,t.length>0){var n=t[0],i=n.getAttribute("secret"),r=n.getElementsByTagName("utc"),o=-1;r.length>0&&(o=(r=r[0]).getAttribute("t")),this._changeConnectStatus(Q.Status.CONNECTED,{secret:i,serverTime:o})}else this._changeConnectStatus(Q.Status.CONNECTED,null)}else"error"===e.getAttribute("type")&&(this._changeConnectStatus(Q.Status.AUTHFAIL,null,e),this.disconnect("authentication failed"));return!1}},{key:"_addSysTimedHandler",value:function(e,t){var n=new Q.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n}},{key:"_addSysHandler",value:function(e,t,n,i,r){var o=new Q.Handler(e,t,n,i,r);return o.user=!1,this.addHandlers.push(o),o}},{key:"_onDisconnectTimeout",value:function(){return Q.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(Q.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}},{key:"_onIdle",value:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var i=(new Date).getTime(),r=[],o=0;o<this.timedHandlers.length;o++){var s=this.timedHandlers[o];!this.authenticated&&s.user||(s.lastCalled+s.period-i<=0?s.run()&&r.push(s):r.push(s))}this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return e._onIdle()}),100))}}]),e}(),Q.SASLMechanism=L,Q.SASLAnonymous=P,Q.SASLPlain=z,Q.SASLSHA1=U,Q.SASLOAuthBearer=F,Q.SASLExternal=H,Q.SASLXOAuth2=G,Q._Conection_Id_=Q.Connection.prototype.getUniqueId("");var $={Strophe:Q,$build:N,$iq:C,$msg:b,$pres:T,SHA1:W,MD5:q,b64_hmac_sha1:W.b64_hmac_sha1,b64_sha1:W.b64_sha1,str_hmac_sha1:W.str_hmac_sha1,str_sha1:W.str_sha1};Q.Request=function(){function e(t,n,i,r){s(this,e),this.id=++Q._requestId,this.xmlData=t,this.data=Q.serialize(t),this.origFunc=n,this.func=n,this.rid=i,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()}return l(e,[{key:"getResponse",value:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw Q.error("invalid response received"),Q.error("responseText: "+this.xhr.responseText),Q.error("responseXML: "+Q.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(Q.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new E).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){Q.error("invalid response received: "+e.querySelector("parsererror").textContent),Q.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=Q.ErrorCondition.BAD_FORMAT,t}}return e}},{key:"_newXHR",value:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}}]),e}(),Q.Bosh=function(){function e(t){s(this,e),this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}return l(e,[{key:"_buildBody",value:function(){var e=N("body",{rid:this.rid++,xmlns:Q.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}},{key:"_reset",value:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}},{key:"_connect",value:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Q.NS.BOSH});n&&i.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new Q.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()}},{key:"_attach",value:function(e,t,n,i,r,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=Q.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(Q.Status.ATTACHED,null)}},{key:"_restore",value:function(e,t,n,i,r){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||Q.getBareJidFromJid(o.jid)===Q.getBareJidFromJid(e)||null===Q.getNodeFromJid(e)&&Q.getDomainFromJid(o.jid)===e))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,i,r)}},{key:"_cacheSession",value:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")}},{key:"_connect_cb",value:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");Q.error("BOSH-Connection failed: "+n);var i=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(Q.Status.CONNFAIL,n)):this._conn._changeConnectStatus(Q.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),Q.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))}},{key:"_disconnect",value:function(e){this._sendTerminate(e)}},{key:"_doDisconnect",value:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}},{key:"_emptyQueue",value:function(){return 0===this._requests.length}},{key:"_callProtocolErrorHandlers",value:function(t){var n=e._getRequestStatus(t),i=this._conn.protocolErrorHandlers.HTTP[n];i&&i.call(this,n)}},{key:"_hitError",value:function(e){this.errors++,Q.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}},{key:"_no_auth_received",value:function(e){Q.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Q.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}},{key:"_onDisconnectTimeout",value:function(){this._abortAllRequests()}},{key:"_abortAllRequests",value:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}},{key:"_onIdle",value:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Q.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Q.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Q.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Q.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(Q.TIMEOUT*this.wait)&&(Q.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Q.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}},{key:"_onRequestStateChange",value:function(t,n){if(Q.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else if(4===n.xhr.readyState){var i=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&i>=400)return this._hitError(i),void this._callProtocolErrorHandlers(n);var r=this._requests[0]===n,o=this._requests[1]===n,s=i>0&&i<500,a=n.sends>this._conn.maxRetries;(s||a)&&(this._removeRequest(n),Q.debug("request id "+n.id+" should now be removed")),200===i?((o||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(Q.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),Q.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0):0===i||i>=400&&i<600||i>=12e3?(Q.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(n),i>=400&&i<500&&(this._conn._changeConnectStatus(Q.Status.DISCONNECTING,null),this._conn._doDisconnect())):Q.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),s||a?a&&!this._conn.connected&&this._conn._changeConnectStatus(Q.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}}},{key:"_processRequest",value:function(t){var n=this,i=this._requests[t],r=e._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=i.age(),s=!isNaN(o)&&o>Math.floor(Q.TIMEOUT*this.wait),a=null!==i.dead&&i.timeDead()>Math.floor(Q.SECONDARY_TIMEOUT*this.wait),c=4===i.xhr.readyState&&(r<1||r>=500);if((s||a||c)&&(a&&Q.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[t]=new Q.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[t]),0===i.xhr.readyState){Q.debug("request id "+i.id+"."+i.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return Q.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(Q.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(i.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.xhr.setRequestHeader(t,e[t])}i.xhr.send(i.data)};if(i.sends>1){var d=1e3*Math.min(Math.floor(Q.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout((function(){l()}),d)}else l();i.sends++,this._conn.xmlOutput!==Q.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==Q.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else Q.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+i.xhr.readyState)}}},{key:"_removeRequest",value:function(e){Q.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}},{key:"_restartRequest",value:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}},{key:"_reqToData",value:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}},{key:"_sendTerminate",value:function(e){Q.debug("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Q.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}},{key:"_send",value:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return e._conn._onIdle()}),100)}},{key:"_sendRestart",value:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}},{key:"_throttledRequestHandler",value:function(){this._requests?Q.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Q.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}],[{key:"_getRequestStatus",value:function(e,t){var n=void 0;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){Q.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}}]),e}(),Q.Bosh.prototype.strip=null,Q.Websocket=function(){function e(t){s(this,e),this._conn=t,this.strip="wrapper";var n=t.service;if(0!==n.indexOf("ws:")&&0!==n.indexOf("wss:")){var i="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?i+="ws":i+="wss",i+="://"+window.location.host,0!==n.indexOf("/")?i+=window.location.pathname+n:i+=n,t.service=i}}return l(e,[{key:"_buildStream",value:function(){return N("open",{xmlns:Q.NS.FRAMING,to:this._conn.domain,version:"1.0"})}},{key:"_checkStreamError",value:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(Q.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var i=n[0],r="",o="",s=0;s<i.childNodes.length;s++){var a=i.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:r=a.nodeName}var c="WebSocket stream error: ";return c+=r||"unknown",o&&(c+=" - "+o),Q.error(c),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0}},{key:"_reset",value:function(){}},{key:"_connect",value:function(){var e=this;this._closeSocket(),this.socket=new S(this._conn.service,"xmpp"),this.socket.onopen=function(){return e._onOpen()},this.socket.onerror=function(t){return e._onError(t)},this.socket.onclose=function(t){return e._onClose(t)},this.socket.onmessage=function(t){return e._onInitialMessage(t)}}},{key:"_connect_cb",value:function(e){if(this._checkStreamError(e,Q.Status.CONNFAIL))return Q.Status.CONNFAIL}},{key:"_handleStreamStart",value:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==Q.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var i=e.getAttribute("version");return"string"!=typeof i?t="Missing version in <open />":"1.0"!==i&&(t="Wrong version in <open />: "+i),!t||(this._conn._changeConnectStatus(Q.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}},{key:"_onInitialMessage",value:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new E).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var i=(new E).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data);var r=i.getAttribute("see-other-uri");if(r){var o=this._conn.service;(o.indexOf("wss:")>=0&&r.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(Q.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect())}else this._conn._changeConnectStatus(Q.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();var s=this._streamWrap(e.data),a=(new E).parseFromString(s,"text/xml").documentElement;this._conn._connect_cb(a,null,e.data)}}},{key:"_replaceMessageHandler",value:function(){var e=this;this.socket.onmessage=function(t){return e._onMessage(t)}}},{key:"_disconnect",value:function(e){var t=this;if(this.socket&&this.socket.readyState!==S.CLOSED){e&&this._conn.send(e);var n=N("close",{xmlns:Q.NS.FRAMING});this._conn.xmlOutput(n.tree());var i=Q.serialize(n);this._conn.rawOutput(i);try{this.socket.send(i)}catch(e){Q.warn("Couldn't send <close /> tag.")}}setTimeout((function(){return t._conn._doDisconnect}),0)}},{key:"_doDisconnect",value:function(){Q.debug("WebSockets _doDisconnect was called"),this._closeSocket()}},{key:"_streamWrap",value:function(e){return"<wrapper>"+e+"</wrapper>"}},{key:"_closeSocket",value:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){Q.debug(e.message)}this.socket=null}},{key:"_emptyQueue",value:function(){return!0}},{key:"_onClose",value:function(e){this._conn.connected&&!this._conn.disconnecting?(Q.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(Q.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(Q.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):Q.debug("Websocket closed")}},{key:"_no_auth_received",value:function(e){Q.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(Q.Status.CONNFAIL,Q.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}},{key:"_onDisconnectTimeout",value:function(){}},{key:"_abortAllRequests",value:function(){}},{key:"_onError",value:function(e){Q.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(Q.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}},{key:"_onIdle",value:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n;n="restart"===e[t]?this._buildStream().tree():e[t];var i=Q.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}}},{key:"_onMessage",value:function(e){var t=void 0,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new E).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var i=this._streamWrap(e.data);t=(new E).parseFromString(i,"text/xml").documentElement}return this._checkStreamError(t,Q.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Q.serialize(t))):void this._conn._dataRecv(t,e.data)}},{key:"_onOpen",value:function(){Q.debug("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=Q.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}},{key:"_reqToData",value:function(e){return e}},{key:"_send",value:function(){this._conn.flush()}},{key:"_sendRestart",value:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}]),e}();var Z={};Z.debug=Q.LogLevel.DEBUG,Z.info=Q.LogLevel.INFO,Z.warn=Q.LogLevel.WARN,Z.error=Q.LogLevel.ERROR,Z.fatal=Q.LogLevel.FATAL,Q.WorkerWebsocket=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._conn=e,n.worker=new SharedWorker(n._conn.options.worker,"Strophe XMPP Connection"),n.worker.onerror=function(e){var t;null===(t=console)||void 0===t||t.error(e),Q.log(Q.LogLevel.ERROR,"Shared Worker Error: "+e)},n}return o(t,e),l(t,[{key:"_connect",value:function(){var e=this;this._messageHandler=function(t){return e._onInitialMessage(t)},this.worker.port.start(),this.worker.port.onmessage=function(t){return e._onWorkerMessage(t)},this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}},{key:"_attach",value:function(e){var t=this;this._messageHandler=function(e){return t._onMessage(e)},this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=function(e){return t._onWorkerMessage(e)},this.worker.port.postMessage(["_attach",this._conn.service])}},{key:"_attachCallback",value:function(e,t){e===Q.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(Q.Status.ATTACHED)):e===Q.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(Q.Status.ATTACHFAIL))}},{key:"_disconnect",value:function(e,t){t&&this._conn.send(t);var n=N("close",{xmlns:Q.NS.FRAMING});this._conn.xmlOutput(n.tree());var i=Q.serialize(n);this._conn.rawOutput(i),this.worker.port.postMessage(["send",i]),this._conn._doDisconnect()}},{key:"_onClose",value:function(e){this._conn.connected&&!this._conn.disconnecting?(Q.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(Q.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(Q.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):Q.debug("Websocket closed")}},{key:"_closeSocket",value:function(){this.worker.port.postMessage(["_closeSocket"])}},{key:"_replaceMessageHandler",value:function(){var e=this;this._messageHandler=function(t){return e._onMessage(t)}}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){Q.log(Q.LogLevel.ERROR,e)}else if("log"===n){var i=t[1],r=t[2];Q.log(Z[i],r)}else Q.log(Q.LogLevel.ERROR,"Found unhandled service worker message: "+t)}},{key:"socket",get:function(){var e=this;return{send:function(t){return e.worker.port.postMessage(["send",t])}}}}]),t}(Q.Websocket),I.$build=$.$build,I.$iq=$.$iq,I.$msg=$.$msg,I.$pres=$.$pres,I.Strophe=$.Strophe;var K=W.b64_sha1;e.$build=N,e.$iq=C,e.$msg=b,e.$pres=T,e.Strophe=Q,e.b64_sha1=K,Object.defineProperty(e,"__esModule",{value:!0})}))}).call(t,n(17))},function(e,t,n){var i;i=function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},o=r.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=0;r<t;r+=4){var o=function(t){t=t;var n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}}(4294967296*(n||e.random()));n=987654071*o(),i.push(4294967296*o()|0)}return new s.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new s.init(n,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new s.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,u=e.min(4*c,r);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(i,l);var d=i.splice(0,c);n.sigBytes-=u}return new s.init(d,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(r.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math);return e},e.exports=i()},function(e,t,n){var i,r,o,s;s=function(){return function(e){function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function i(e,t,n,i){for(var r=0;r<e.length;r++){var o=e[r];if("string"==typeof o){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if("function"==typeof o&&o(t,n,i))break}return r!=e.length}function r(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function o(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),i=t[5].split(".");if(n.setHours(t[3],t[4],i[0]),i.length>1&&n.setMilliseconds(i[1]),t[6]&&t[7]){var r=60*t[6]+Number(t[7]);r=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*r:r),n.setMinutes(n.getMinutes()-r-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function s(t,n,r){if(e.datetimeAccessFormPaths.length>0){var s=r.split(".#")[0];return i(e.datetimeAccessFormPaths,t,n,s)?o(t):t}return t}function a(t,n,r,o){return!(n==y.ELEMENT_NODE&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,t,r,o)}function c(n,i){if(n.nodeType==y.DOCUMENT_NODE){for(var o=new Object,u=n.childNodes,l=0;l<u.length;l++)(d=u.item(l)).nodeType==y.ELEMENT_NODE&&(o[h=t(d)]=c(d,h));return o}if(n.nodeType==y.ELEMENT_NODE){for((o=new Object).__cnt=0,u=n.childNodes,l=0;l<u.length;l++){var d,h=t(d=u.item(l));if(d.nodeType!=y.COMMENT_NODE){var m=i+"."+h;a(o,d.nodeType,h,m)&&(o.__cnt++,null==o[h]?(o[h]=c(d,m),r(o,h,m)):(null!=o[h]&&(o[h]instanceof Array||(o[h]=[o[h]],r(o,h,m))),o[h][o[h].length]=c(d,m)))}}for(var f=0;f<n.attributes.length;f++){var p=n.attributes.item(f);o.__cnt++,o[e.attributePrefix+p.name]=p.value}var g=function(e){return e.prefix}(n);return null!=g&&""!=g&&(o.__cnt++,o.__prefix=g),null!=o["#text"]&&(o.__text=o["#text"],o.__text instanceof Array&&(o.__text=o.__text.join("\n")),e.stripWhitespaces&&(o.__text=o.__text.trim()),delete o["#text"],"property"==e.arrayAccessForm&&delete o["#text_asArray"],o.__text=s(o.__text,h,i+"."+h)),null!=o["#cdata-section"]&&(o.__cdata=o["#cdata-section"],delete o["#cdata-section"],"property"==e.arrayAccessForm&&delete o["#cdata-section_asArray"]),0==o.__cnt&&"text"==e.emptyNodeForm?o="":1==o.__cnt&&null!=o.__text?o=o.__text:1!=o.__cnt||null==o.__cdata||e.keepCData?o.__cnt>1&&null!=o.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==o.__text||""==o.__text.trim())&&delete o.__text:o=o.__cdata,delete o.__cnt,!e.enableToStringFunc||null==o.__text&&null==o.__cdata||(o.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),o}if(n.nodeType==y.TEXT_NODE||n.nodeType==y.CDATA_SECTION_NODE)return n.nodeValue}function u(t,i,r,o){var s="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var a=0;a<r.length;a++){var c=r[a],u=t[c];e.escapeMode&&(u=n(u)),s+=" "+c.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?s+='"'+u+'"':s+="'"+u+"'"}return s+(o?"/>":">")}function l(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function d(t,n){return!!("property"==e.arrayAccessForm&&function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(n.toString(),"_asArray")||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function)}function h(e){var t=0;if(e instanceof Object)for(var n in e)d(e,n)||t++;return t}function m(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||i(e.jsonPropertiesFilter,t,n,r)}function f(t){var n=[];if(t instanceof Object)for(var i in t)-1==i.toString().indexOf("__")&&0==i.toString().indexOf(e.attributePrefix)&&n.push(i);return n}function p(t){var i="";return t instanceof Object?i+=function(t){var i="";return null!=t.__cdata&&(i+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?i+=n(t.__text):i+=t.__text),i}(t):null!=t&&(e.escapeMode?i+=n(t):i+=t),i}function g(e,t){return""===e?t:e+"."+t}function v(e,t,n,i){var r="";if(0==e.length)r+=u(e,t,n,!0);else for(var o=0;o<e.length;o++)r+=u(e[o],t,f(e[o]),!1),r+=_(e[o],g(i,t)),r+=l(e[o],t);return r}function _(e,t){var n="";if(h(e)>0)for(var i in e)if(!d(e,i)&&(""==t||m(e,i,g(t,i)))){var r=e[i],o=f(r);null==r||null==r?n+=u(r,i,o,!0):r instanceof Object?r instanceof Array?n+=v(r,i,o,t):r instanceof Date?(n+=u(r,i,o,!1),n+=r.toISOString(),n+=l(r,i)):h(r)>0||null!=r.__text||null!=r.__cdata?(n+=u(r,i,o,!1),n+=_(r,g(t,i)),n+=l(r,i)):n+=u(r,i,o,!0):(n+=u(r,i,o,!1),n+=p(r),n+=l(r,i))}return n+p(e)}void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1);var y={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t,n=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var i=new window.DOMParser,r=null;if(!n)try{r=i.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){r=null}try{t=i.parseFromString(e,"text/xml"),null!=r&&t.getElementsByTagNameNS(r,"parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?o(e):e},this.xml2json=function(e){return c(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return _(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}}},r=[],void 0!==(o="function"==typeof(i=s)?i.apply(t,r):i)&&(e.exports=o)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("ackmessage",{_c:null,ackcb:null,sessioncb:null,onEcho:null,init:function(t){this._c=t,e.addNamespace("ZOOMEXT","zoom:iq:ext")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||this._c.addHandler(this._onReceivIQ.bind(this),null,"iq","result")},_onReceivIQ:function(t){var n=t.attributes,i=null!=n.getNamedItem("id")?n.getNamedItem("id").value:"";try{var r=t.getElementsByTagName("zoom");if(0==r.length)return!0;var o=[],s=r[0],a=s.attributes;if(null==a.getNamedItem("xmlns"))return!0;if(a.getNamedItem("xmlns").value==e.NS.ZOOMEXT){var c=a.getNamedItem("type").value;if("offline"===c){if("function"==typeof this.sessioncb){for(var u=s.getElementsByTagName("acktime"),l=0;l<u.length;l++){var d=u[l].attributes,h={};h.session=d.getNamedItem("session").value,h.ack=d.getNamedItem("ack").value,h.read=d.getNamedItem("read").value,o.push(h)}return this.sessioncb(o),!0}}else"echo"===c&&this.onEcho(i)}}catch(t){return e.error("error on parse "+t),!0}return this.ackcb&&this.ackcb(i),!0},ack:function(t,i,r,o,s){var a=this._c.getUniqueId("ack");try{var c=n({id:a,type:"get",xmlns:e.NS.CLIENT}).c("zoom",{xmlns:"zoom:iq:ext",action:"ack_msg",time:t,from:e.getNodeFromJid(i),sender:i});this._c.sendIQ(c,r,o,s)}catch(t){e.error(t)}return a},read:function(t){var i=this._c.getUniqueId("read"),r=n({id:i,type:"get",xmlns:e.NS.CLIENT});if(null==t.action?r.c("zoom",{xmlns:"zoom:iq:read",from:e.getNodeFromJid(t.from),group:t.group}):r.c("zoom",{xmlns:"zoom:iq:read",from:e.getNodeFromJid(t.from),action:t.action,group:t.group}),null!=t.items)for(var o=0;o<t.items.length;o++)r.c("item",{time:t.items[o].time}).up();this._c.sendIQ(r)},addAckHandler:function(e){this.ackcb=e},addSessionHandel:function(e){this.sessioncb=e},addEchoHandel:function(e){this.onEcho=e}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("iqpresence",{_c:null,_vardcb:null,_deviceCb:null,init:function(t){this._c=t,e.addNamespace("IQPRESENCE","zoom:iq:presence")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||this._c.addHandler(this._onReceivIQ.bind(this),null,"iq","result")},_onReceivIQ:function(t){var n=t.getElementsByTagName("zoom");if(n.length<=0)return!0;var i=null!=(n=n[0]).attributes.getNamedItem("type")?n.attributes.getNamedItem("type").value:"",r=null!==n.attributes.getNamedItem("action")?n.attributes.getNamedItem("action").value:"";if("presence"===i){e.info("iqpresence process"),e.info(t);var o=[],s=n.getElementsByTagName("item");try{for(var a=0;a<s.length;a++){var c={},u=s[a];c.jid=u.attributes.getNamedItem("jid").value,c.mobile=u.attributes.getNamedItem("mobile").value;for(var l=u.getElementsByTagName("res"),d=[],h=0;h<l.length;h++){var m={},f=l[h];m.resource=null!=f.attributes.getNamedItem("resource")?f.attributes.getNamedItem("resource").value:"",m.show=f.attributes.getNamedItem("show").value,m.status=f.attributes.getNamedItem("status").value;var p=f.getElementsByTagName("zcap");p.length>0&&(p=p[0],m.zcap=p.textContent);var g=f.getElementsByTagName("c");if(g.length>0){var v={};g=g[0],v.hash=null!=g.attributes.getNamedItem("hash")?g.attributes.getNamedItem("hash").value:"",v.ver=null!=g.attributes.getNamedItem("ver")?g.attributes.getNamedItem("ver").value:"",m.c=v}d.push(m)}c.res=d,o.push(c)}"function"==typeof this._vardcb&&this._vardcb(o)}catch(t){e.error(t)}}else if("getdevices"===r){e.info("iqdevice process"),e.info(t);var _=n.getElementsByTagName("item"),y=[];try{for(var N=0;N<_.length;N++){var b=_[N],C={name:b.attributes.getNamedItem("dname").value||"",resource:b.attributes.getNamedItem("resource").value||"",deviceId:b.attributes.getNamedItem("deviceid").value||""};y.push(C)}this._deviceCb&&this._deviceCb(y)}catch(t){e.error(t)}}return!0},queryPresence:function(){var t=this._c.getUniqueId("iqpresence"),i=n({id:t,type:"get",from:e.getBareJidFromJid(this._c.jid),xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.IQPRESENCE,chunk:"1",details:"1"});this._c.sendIQ(i)},queryDevice:function(){var t=this._c.getUniqueId(),i=n({type:"get",id:t,from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("zoom",{xmlns:"zoom:iq:ext",action:"getdevices"});this._c.sendIQ(i)},addIQPresenceCB:function(e){this._vardcb=e},addIQDeviceCB:function(e){this._deviceCb=e}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){var o=function(e){var t=e.zmpoll;if(t)return{action:t._action||"",data:t.data||t._id||""};if(e.zmext&&e.zmext._action&&e.zmext._action.indexOf("webinar_")>-1){var n=e.zmext._action.replace("webinar_",""),i={action:n,data:[]};if(n.indexOf("putdownhands")>-1){var r=[];"[object Array]"===Object.prototype.toString.call(e.zmext.jid)?r=e.zmext.jid:r.push(e.zmext.jid),i.data=r}return i}return null};e.addConnectionPlugin("Messaging",{_connection:null,_composingTimeout:3e3,_composing:{},_msgcb:null,_recentchatcb:null,_poolcb:null,init:function(t){this._connection=t,e.addNamespace("XHTML_IM","http://jabber.org/protocol/xhtml-im"),e.addNamespace("XHTML","http://www.w3.org/1999/xhtml"),e.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),e.addNamespace("IqPrivate","jabber:iq:private"),this._parseMsg.bind(this)},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||(this._connection.addHandler(this._onReceiveChatMessage.bind(this),null,"message","chat"),this._connection.addHandler(this._onReceiveGroupChatMessage.bind(this),null,"message","groupchat"),this._connection.addHandler(this._onReceiveRecentChat.bind(this),e.NS.IqPrivate,"iq",null))},addMessageCB:function(e){this._msgcb=e},addPoolCB:function(e){this._poolcb=e},addRecentChatCB:function(e){this._recentchatcb=e},_parseMsg:function(t){return e.xml2json(t)},_onReceiveChatMessage:function(t){try{var n=this._parseMsg(t),i=o.call(this,n);i?this._poolcb(i):"function"==typeof this._msgcb&&this._msgcb(n)}catch(t){e.error(t)}return!0},_onReceiveGroupChatMessage:function(t){try{var n=this._parseMsg(t),i=o.call(this,n);i?this._poolcb(i):"function"==typeof this._msgcb&&this._msgcb(n)}catch(t){e.error(t)}return!0},sendMessage:function(t){var n="{"+this._connection.getUniqueId()+"}",i=(this._connection.jid,t.message);i._xmlns="jabber:client",i._id=n;var r=e.json2xml(t);return r&&this._connection.send(r),n},queryRecentChat:function(){var t="{"+this._connection.getUniqueId("recentchat")+"}",n={iq:{_id:t,_type:"get",_from:this._connection.jid,_xmlns:"jabber:client",query:{_xmlns:e.NS.IqPrivate,recentchat:{_xmlns:"zoom:iq:recentchat"}}}};return n=e.json2xml(n),this._connection.send(n),t},_onReceiveRecentChat:function(t){if(t=e.xml2json(t),this._recentchatcb&&t&&t.query&&t.query.recentchat){var n=t.query.recentchat.item,i=[];n.length?(i=n.map((function(e){return e._v})),this._recentchatcb(i)):e.log("no recent chat")}},requestLcp:function(t,n,i,r,o){var s=this._connection.getUniqueId(),a={message:{_from:this._connection.jid+"/"+e.Resource,_id:s,_type:"chat",_to:this._connection.jid+"/"+o,zext_call:{action:"request_lcp",raw:";;"+t+";0;6;"+this._connection.jid+";"+e._Conection_Id_+";"+r+";;0;0;140;;;;;;"+e.Resource+";",src_deviceid:e._Conection_Id_,dst_deviceid:n,caption:i,notify_other_devices:0},zmtask:{_feature:"34"},zmext:{_t:(new Date).getTime(),msg_type:"57",from:{_n:r,_res:e.Resource},visible:!1}}},c=e.json2xml(a);this._connection.send(c)},sendInviteContactSyncMessage:function(t){var n="{"+this._connection.getUniqueId()+"}",i=this._connection.jid,r=t.message;r._xmlns="jabber:client",r._id=n,r._to=i,r._from=i+"/"+e.Resource,r.zmext.from._res=e.Resource;var o=e.json2xml(t);o&&this._connection.send(o)},sendLcp:function(t,n,i,r,o,s){var a=this._connection.getUniqueId(),c={message:{_from:this._connection.jid+"/"+e.Resource,_id:a,_type:"chat",_to:this._connection.jid+"/"+i,zext_call:{action:"transfer_lcp",raw:";;"+t+";0;5;"+this._connection.jid+";"+e._Conection_Id_+";"+n+";;0;0;139;;;;;;"+e.Resource+";",src_deviceid:e._Conection_Id_,dst_deviceid:r,caption:o,notify_other_devices:0,lcp:s},zmtask:{_feature:"34"},zmext:{_t:(new Date).getTime(),msg_type:"56",from:{_n:n,_res:e.Resource},visible:!1}}},u=e.json2xml(c);this._connection.send(u)}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("ping",{_c:null,init:function(t){this._c=t,e.addNamespace("PING","urn:xmpp:ping")},ping:function(t,i,r,o){var s=this._c.getUniqueId("ping"),a=n({type:"get",to:t,id:s}).c("ping",{xmlns:e.NS.PING});this._c.sendIQ(a,i,r,o)},pong:function(e){var t=e.getAttribute("from"),i=e.getAttribute("id"),r=n({type:"result",to:t,id:i});this._c.sendIQ(r)},addPingHandler:function(t){return this._c.addHandler(t,e.NS.PING,"iq","get")}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("presence",{_c:null,_presencecb:null,init:function(t){this._c=t,e.addNamespace("tempPresence","zoom:iq:temp_presence"),e.addNamespace("notify","zoom:iq:notify"),e.addNamespace("snooze","zoom:notify:snooze"),e.addNamespace("ext","zoom:iq:ext")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||(this._c.addHandler(this._onReceivIQ.bind(this),null,"iq",null),this._c.addHandler(this._onReceivePresence.bind(this),null,"presence",null))},sendWebinarPresence:function(t,n,i,o){var s="w_"+t+"@conference."+e.getDomainFromJid(this._c.jid)+"/"+n,a=r({xmlns:e.NS.CLIENT,to:s}).c("x",{xmlns:e.NS.MUC}).up().c("item",{node:n,role:i,displayName:o,"client-feature":0});this._c.send(a.tree())},online:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("status").t("NA").up().c("priority").t("15").up();t&&n.c("manual").t("1").up(),this._c.send(n.tree())},offline:function(){var t=r({from:this._c.jid+"/"+e.Resource,to:this._c.jid+"/"+e.Resource,type:"unavailable",xmlns:e.NS.CLIENT});this._c.send(t.tree())},busy:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("away").up().c("status").t("BUSY").up().c("priority").t("15").up().c("zcap").t("e2e:none").up();t&&n.c("manual").t("1").up(),this._c.send(n.tree())},duration:function(t){var i=this._c.getUniqueId(),r=Math.floor((new Date).getTime()/1e3),o=n({type:"set",id:i,from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.notify,sync:"true"}).c("snooze",{xmlns:e.NS.snooze,duration:t,snooze_from:r,snooze_to:r+60*t});this._c.send(o.tree())},dnd:function(){var t=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("xa").up().c("priority").t("15").up().c("status").t("NA").up().c("zcap").t("e2e:none").up();this._c.send(t.tree())},queryDuration:function(){var t=this._c.getUniqueId(),i=n({type:"get",id:t,from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.notify}).c("snooze",{xmlns:e.NS.snooze});this._c.send(i.tree())},inMeeting:function(t){var n=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("dnd").up().c("status").t("ZM").up().c("priority").t("15").up();if(this._c.send(n.tree()),t){var i=e.Base64.stringify(e.Utf8.parse(JSON.stringify({info:[t]})));n.c("zcap").t("e2e:none").up().c("mcap").t(i).up()}this._c.send(n.tree())},isPresenting:function(){var t=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("dnd").up().c("status").t("ZP").up().c("priority").t("15").up();this._c.send(t.tree())},inPhoneCall:function(){var t=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("dnd").up().c("status").t("PBX").up().c("priority").t("15").up();this._c.send(t.tree())},away:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=r({from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("show").t("away").up().c("status").t("NA").up().c("priority").t("15").up();t&&n.c("manual").t("1").up(),this._c.send(n.tree())},subscribe:function(t){t=t||[];var i=this._c.getUniqueId("presence"),r=n({type:"set",id:i,from:this._c.jid+"/"+e.Resource,xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.tempPresence,version:"2.0",action:"subscribe"});t.forEach((function(e){var t=e.jid,n=e.expireTime;r.c("item",{jid:t,expire_time:n}).up()})),this._c.send(r.tree())},unsubscribe:function(){},_onReceivePresence:function(t){e.info("presence process"),e.info(t);try{var n={},i=t.attributes,r=null!=i.getNamedItem("from")?i.getNamedItem("from").value:null,o=null!=i.getNamedItem("to")?i.getNamedItem("to").value:null,s=null!=i.getNamedItem("type")?i.getNamedItem("type").value:null,a=t.getElementsByTagName("mcap");if(a[0]&&(n.meetingInfo=JSON.parse(e.Utf8.stringify(e.Base64.parse(a[0].textContent))).info),null===s||s==s==="available")n.show="available";else if("unavailable"===s)n.show="offline";else if("sub-ack"===s||"subscribe"===s||"subscribed"===s||"unsubscribed"===s){var c=null!=i.getNamedItem("email")?i.getNamedItem("email").value:null,u={type:{"sub-ack":"INVITE_MESSAGE_SEND_SUCCESS",subscribe:"INVITE_CONTACT_OTHERS_INVITE_ME",subscribed:"INVITE_CONTACT_BE_ACCEPTED",unsubscribed:"INVITE_CONTACT_BE_DECLINED"}[s],email:c,from:r,to:o},l=null!=i.getNamedItem("sameorg")?i.getNamedItem("sameorg").value:null;l&&(u.sameorg=l),null!=(d=t.getElementsByTagName("status"))&&d.length>0&&(d=d[0],u.status=d.textContent?JSON.parse(d.textContent):{}),n.inviteContactResponse=u}var d,h=t.getElementsByTagName("show");null!=h&&h.length>0&&(h=h[0],n.show=h.textContent),null!=(d=t.getElementsByTagName("status"))&&d.length>0&&(d=d[0],n.status=d.textContent),n.from=r,n.to=o,n.isManual=this._isPresenceIsManuallySet(t),"function"==typeof this._presencecb&&this._presencecb(n)}catch(t){e.error(t)}return!0},_onReceivIQ:function(t){e.info("presence _onReceivIQ"),e.info(t);try{var n=t.getElementsByTagName("zoom");if(n.length>0){var i=n[0],r=i.attributes;if(r.getNamedItem("xmlns").value===e.NS.ext){var o=r.getNamedItem("type").value;if("r_remove"===o){for(var s=i.getElementsByTagName("rosteritem"),a=[],c=0;c<s.length;c++){var u=s[c].attributes,l=null!=u.getNamedItem("jid")?u.getNamedItem("jid").value:"";l&&a.push({jid:l,type:o})}return a.length>0&&this._rostercb({type:"remove",data:a}),!0}}}var d=t.getElementsByTagName("query");if(d.length>0){var h=d[0],m=h.attributes.getNamedItem("xmlns").value;if(m===e.NS.ROSTER){var f=h.getElementsByTagName("item"),p=[];if(f.length>0)for(var g=0;g<f.length;g++){var v={},_=f[g].attributes,y=null!=_.getNamedItem("subscription")?_.getNamedItem("subscription").value:"",N=null!=_.getNamedItem("jid")?_.getNamedItem("jid").value:"";if(N){v.subscription=y,v.jid=N;var b=f[g].getElementsByTagName("group");if(b.length>0){var C=b[0].textContent;v.group=C}p.push(v)}}p.length>0&&this._rostercb({type:"add",data:p})}if(m===e.NS.notify){var T=h.getElementsByTagName("snooze");if(T.length>0){var I=(T=T[0]).attributes.getNamedItem("duration").value;"function"==typeof this._iqcb&&this._iqcb(I)}}}}catch(t){e.error(t)}return!0},_isPresenceIsManuallySet:function(e){for(var t=e.attributes.getNamedItem("xmlns").ownerElement.children,n=0;n<t.length;n++){var i=t.item(n),r=i.localName.toLowerCase(),o=i.innerHTML;if("manual"===r&&"1"===o)return!0}return!1},addPresenceHandle:function(e){this._presencecb=e},addIQHandle:function(e){this._iqcb=e},addRosterHandle:function(e){this._rostercb=e},inviteContactByEmail:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inviterName,i=void 0===n?"":n,o=t.inviterEmail,s=void 0===o?"":o,a=t.inviteeEmail,c=void 0===a?"":a;if(s&&c){var u=r({email:c,from:this._c.jid+"/"+e.Resource,type:"subscribe",xmlns:e.NS.CLIENT}).c("status").t(JSON.stringify({e:s,screenname:i,t:Date.now()})).up();this._c.send(u.tree())}},deleteContactByJid:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t&&this._c.jid!==t){var n=r({from:this._c.jid+"/"+e.Resource,to:t,type:"unsubscribe",xmlns:e.NS.CLIENT});this._c.send(n.tree())}}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o,s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};o=function(e,t,n,i,r){e.addConnectionPlugin("room",{_c:null,roomcb:null,init:function(t){this._c=t,e.addNamespace("ZOOMROOM","zoom:iq:room")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||this._c.addHandler(this._onReceivIQ.bind(this),null,"iq","result")},_onReceivIQ:function(t){var n=t.attributes,i=null!=n.getNamedItem("id")?n.getNamedItem("id").value:"";try{var r=t.getElementsByTagName("zoom"),o=t.getElementsByTagName("room");if(r.length>0){var s=r[0];if((g=s.attributes).getNamedItem("xmlns").value===e.NS.ZOOMROOM){var a=null,c=null;try{a=s.getElementsByTagName("roomlist")}catch(e){}try{c=g.getNamedItem("action").value}catch(e){}if(null!=a&&a.length>0){for(var u=[],l=a[0].getElementsByTagName("item"),d=0;d<l.length;d++){var h=(_=l[d]).attributes;(y={}).version=h.getNamedItem("version").value,y.diff=h.getNamedItem("diff").value,y.node=e.getNodeFromJid(_.textContent),y.server=e.getDomainFromJid(_.textContent),u.push(y)}return this.roomcb(e.ACTION.ROOMS_CALLBACK_STATE,u),!0}if("member"===c){var m=n.getNamedItem("from").value,f=(g.getNamedItem("chunk").value,{}),p=[];N=(N=s.getElementsByTagName("room"))[0],f.jid=m,f.node=e.getNodeFromJid(m),f.server=e.getDomainFromJid(m);var g=N.attributes;f.natural=g.getNamedItem("natural").value,f.subject=g.getNamedItem("subject").value,f.desc=g.getNamedItem("desc").value,f.option=g.getNamedItem("option").value,f.version=g.getNamedItem("version").value;var v=s.getElementsByTagName("buddylist");if(v.length>0)for(g=(v=v[0]).attributes,f.total=g.getNamedItem("total").value,f.first=g.getNamedItem("first").value,l=v.getElementsByTagName("item"),d=0;d<l.length;d++){var _,y;h=(_=l[d]).attributes,(y={}).nickname=h.getNamedItem("nickname").value,y.role=h.getNamedItem("role").value,y.displayName=h.getNamedItem("displayName").value,y.jid=_.textContent,y.node=e.getNodeFromJid(_.textContent),p.push(y)}f.items=p,this.roomcb(e.ACTION.ROOMS_DETAIL_CALLBACK_STATE,f)}}}else if(o.length>0){var N;if((g=(N=o[0]).attributes).getNamedItem("xmlns").value===e.NS.ZOOMROOM){c=null;try{c=g.getNamedItem("action").value}catch(e){}c&&this.roomcb({type:"result",id:i,data:{action:c}})}}}catch(t){return e.error("error on parse "+t),!0}return!0},onErrorOrTimout:function(e){var t=e.id;"function"==typeof this.roomcb&&this.roomcb({type:"error",id:t,data:null})},changeRoomOption:function(t){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this._c.getUniqueId("room"),a=n({id:o,type:"set",from:e.getBareJidFromJid(this._c.jid)+"/"+e.Resource,to:t,xmlns:e.NS.CLIENT}).c("zoom",{xmlns:e.NS.ZOOMROOM,action:"edit"});return Object.entries(r).forEach((function(e){var t=s(e,2),n=t[0],i=t[1];a.c(n,{},i)})),this._c.sendIQ(a,null,(function(){i.onErrorOrTimout({id:o})}),3e3),o},addRoomHandler:function(e){this.roomcb=e}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("roster",{_c:null,rostercb:null,init:function(t){this._c=t,e.addNamespace("ZOOMGROUP","zoom:iq:group")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||this._c.addHandler(this._onReceivIQ.bind(this),null,"iq","result")},_onReceivIQ:function(t){var n=t.attributes,i=(null!=n.getNamedItem("id")&&n.getNamedItem("id").value,t.getElementsByTagName("blocklist"));if(0!==i.length){var r=i[0],o=Array.from(r.getElementsByTagName("item")).map((function(e){return e.attributes.getNamedItem("jid").value}));return this.rostercb(100,o),!0}try{var s=t.getElementsByTagName("zoom");if(0==s.length)return!0;var a=s[0];if((m=a.attributes).getNamedItem("xmlns").value==e.NS.ZOOMEXT){try{var c=null!=m.getNamedItem("type")?m.getNamedItem("type").value:""}catch(e){}if("roster"===c){if("function"==typeof this.rostercb){var u={},l=[];u.chunk=m.getNamedItem("chunk").value;var d={},h=a.getElementsByTagName("default");if(h.length>0){u.group=d;var m=(M=h[0]).attributes;d.total=null!=m.getNamedItem("total")?m.getNamedItem("total").value:0,d.first=null!=m.getNamedItem("first")?m.getNamedItem("first").value:0,d.version=null!=m.getNamedItem("version")?m.getNamedItem("version").value:0,d.items=[];for(var f=M.getElementsByTagName("item"),p=0;p<f.length;p++){var g=f[p].attributes;(P={}).jid=null!=g.getNamedItem("jid")?g.getNamedItem("jid").value:"",P.fname=null!=g.getNamedItem("fname")?g.getNamedItem("fname").value:"",P.lname=null!=g.getNamedItem("lname")?g.getNamedItem("lname").value:"",P.type=null!=g.getNamedItem("type")?g.getNamedItem("type").value:0,P.cmd=null!=g.getNamedItem("cmd")?g.getNamedItem("cmd").value:"";var v=f[p].getElementsByTagName("group"),_="default";v.length>0&&(_=v[0].textContent),P.gname=_,d.items.push(P)}}for(var y=a.getElementsByTagName("group"),N=0;N<y.length;N++){var b=y[N],C=b.attributes;if(null!=C.getNamedItem("version")){var T={};T.total=null!=C.getNamedItem("total")?C.getNamedItem("total").value:0,T.first=null!=C.getNamedItem("first")?C.getNamedItem("first").value:0,T.id=null!=C.getNamedItem("id")?C.getNamedItem("id").value:0,T.diff=null!=C.getNamedItem("diff")?C.getNamedItem("diff").value:0,T.version=null!=C.getNamedItem("version")?C.getNamedItem("version").value:0,T.name=null!=C.getNamedItem("name")?C.getNamedItem("name").value:"",T.option=null!=C.getNamedItem("option")?C.getNamedItem("option").value:0;var I=b.getElementsByTagName("item"),S=[];for(p=0;p<I.length;p++)g=I[p].attributes,(P={}).jid=null!=g.getNamedItem("jid")?g.getNamedItem("jid").value:"",P.fname=null!=g.getNamedItem("fname")?g.getNamedItem("fname").value:"",P.lname=null!=g.getNamedItem("lname")?g.getNamedItem("lname").value:"",P.type=null!=g.getNamedItem("type")?g.getNamedItem("type").value:0,P.cmd=null!=g.getNamedItem("cmd")?g.getNamedItem("cmd").value:"",P.gname=T.name,S.push(P);if(T.items=S,0!=T.diff){var E=[],x=b.getElementsByTagName("update");for(p=0;p<x.length;p++)g=x[p].attributes,(P={}).jid=null!=g.getNamedItem("jid")?g.getNamedItem("jid").value:"",P.fname=null!=g.getNamedItem("fname")?g.getNamedItem("fname").value:"",P.lname=null!=g.getNamedItem("lname")?g.getNamedItem("lname").value:"",P.gname=T.name,E.push(P);T.updates=E;var O=[],R=b.getElementsByTagName("delete");for(p=0;p<R.length;p++)g=R[p].attributes,(P={}).jid=null!=g.getNamedItem("jid")?g.getNamedItem("jid").value:"",O.push(P);T.deletes=O;var w=[],A=b.getElementsByTagName("add");for(p=0;p<A.length;p++)g=A[p].attributes,(P={}).jid=null!=g.getNamedItem("jid")?g.getNamedItem("jid").value:"",P.fname=null!=g.getNamedItem("fname")?g.getNamedItem("fname").value:"",P.lname=null!=g.getNamedItem("lname")?g.getNamedItem("lname").value:"",P.gname=T.name,w.push(P);T.adds=w}l.push(T)}}u.groups=l,this.rostercb(e.ACTION.ROSTER_ITEMS_CB,u)}}else if("version"===c&&"function"==typeof this.rostercb){var M,k=[],D=a.getElementsByTagName("default");D=D[0],(M={id:"default"}).version=D.attributes.getNamedItem("version").value,M.type="default",k.push(M);var q=a.getElementsByTagName("group");for(N=0;N<q.length;N++){var L=q[N],P={};g=L.attributes,P.version=null!=g.getNamedItem("version")?g.getNamedItem("version").value:"0",P.id=null!=g.getNamedItem("id")?g.getNamedItem("id").value:"0",P.type=null!=g.getNamedItem("type")?g.getNamedItem("type").value:"0",k.push(P)}this.rostercb(e.ACTION.ROSTER_VERSION_CB,k)}}}catch(t){e.error("error on roster parse "+t)}return!0},queryChunk:function(t){var i=this._c.getUniqueId("group"),r=n({id:i,type:"get",from:e.getBareJidFromJid(this._c.jid),xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.ZOOMGROUP,chunk:t});return this._c.sendIQ(r),i},queryGroups:function(t,i,r,o){for(var s=t.chunk,a=t.directory,c=t.groups,u=this._c.getUniqueId("group"),l=n({id:u,type:"get",from:e.getBareJidFromJid(this._c.jid),xmlns:e.NS.CLIENT}).c("query",{xmlns:e.NS.ZOOMGROUP,chunk:s,directory:a}),d=0;d<c.length;d++){var h=c[d];"default"===h.id?l.c("default",{version:h.version,option:h.option}).up():l.c("group",{id:h.id,version:h.version,option:h.option}).up()}return this._c.sendIQ(l,i,r,o),u},queryGroupInfos:function(t,i,r){var o=this._c.getUniqueId("group"),s=n({id:o,type:"get",from:e.getBareJidFromJid(this._c.jid),xmlns:e.NS.CLIENT}).c("query",{xmlns:"zoom:iq:version"});return this._c.sendIQ(s,t,i,r),o},fetchBlockList:function(t,i,r){var o=this._c.getUniqueId("roster"),s=n({id:o,type:"get",from:e.getBareJidFromJid(this._c.jid),xmlns:e.NS.CLIENT}).c("blocklist",{xmlns:"urn:xmpp:blocking"});return this._c.sendIQ(s,t,i,r),o},addRosterHandler:function(e){this.rostercb=e}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i,r,o;o=function(e,t,n,i,r){e.addConnectionPlugin("vcard",{_c:null,_vardcb:null,init:function(t){this._c=t,e.addNamespace("vCard","vcard-temp")},statusChanged:function(t,n){t!==e.Status.CONNECTED&&t!==e.Status.ATTACHED||this._c.addHandler(this._onReceivIQ.bind(this),null,"iq","result")},_onReceivIQ:function(t){var n={},i=t.attributes;null!=i.getNamedItem("id")&&i.getNamedItem("id").value;try{if(0==t.getElementsByTagName("vCard").length){var r=t.getElementsByTagName("zoom");if(0==r.length)return!0;var o=r[0].attributes,s=o.getNamedItem("type");return null==s||"vcard_update"===s.value&&(n.action="update",n.jid=o.getNamedItem("jid").value,"function"==typeof this._vardcb&&this._vardcb(n)),!0}(n=e.formatVcard(t.innerHTML)).action="vcard","function"==typeof this._vardcb&&this._vardcb(n)}catch(t){e.error(t)}return!0},query:function(t,i,r,o){var s=this._c.getUniqueId("vcard"),a=n({type:"get",to:t,id:s}).c("vCard",{xmlns:e.NS.vCard});this._c.sendIQ(a,i,r,o)},addVCardHandler:function(e){return this._vardcb=e}})},i=[n(0)],void 0!==(r=function(e){return o(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,i))&&(e.exports=r)},function(e,t,n){var i;i=function(e){return function(){function t(e,t,n){for(var r=[],o=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2;r[o>>>2]|=(a|c)<<24-o%4*8,o++}return i.create(r,o)}var n=e,i=n.lib.WordArray;n.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)r.push(i.charAt(s>>>6*(3-a)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var n=e.length,i=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var o=0;o<i.length;o++)r[i.charCodeAt(o)]=o}var s=i.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(n=a)}return t(e,n,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64},e.exports=i(n(1))},function(e,t,n){var i;i=function(e){return e.enc.Utf8},e.exports=i(n(1))},function(e,t,n){var i;i=function(e){return e.HmacSHA256},e.exports=i(n(1),n(16),n(15))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n.n(i),o=n(0),s=(n.n(o),n(13)),a=n.n(s),c=n(11),u=n.n(c),l=n(12),d=n.n(l),h=n(6),m=(n.n(h),n(3)),f=(n.n(m),n(4)),p=(n.n(f),n(5)),g=(n.n(p),n(7)),v=(n.n(g),n(8)),_=(n.n(v),n(9)),y=(n.n(_),n(10)),N=(n.n(y),new r.a({enableToStringFunc:!1}));o.Strophe.formatVcard=function(e){var t=N.xml_str2json(e).vCard,n=t.JABBERID,i=t.N,r=t.SIG,o=t.DESC,s=t.TEL,a=t.INTRO,c=t.EXT,u=t.ORG,l=t.USER_TYPE,d=t.EMAIL,h=t.WKLOC,m={jid:n};if(i&&(m.firstName=i.GIVEN||"",m.lastName=i.FAMILY||"",m.nickName=i.NICK||""),o&&(m.picUrl=o||""),d&&(d.WORK||d.USERID)&&(m.email=d.WORK||d.USERID),u&&u.ORGUNIT&&(m.organization=u.ORGUNIT.split(";").filter(Boolean)),r&&(m.signature={begin:r._begin,end:r._end,option:r._option,text:r.__text}),s&&(Array.isArray(s)?s.map((function(e,t){if("SIP"in e||"PBX"in e||(m.phone={sip:e.SIP||"",normal:e.NUMBER||"",work:e.WORK&&e.WORK.NUMBER||"",home:e.HOME&&e.HOME.NUMBER||""}),"SIP"in e&&(m.sip={normal:e.NUMBER||""}),"PBX"in e){var n=e.NUMBER||"{}",i=JSON.parse(n)||{},r=i.ext,o=i.dn,s=i.cn;m.pbx={ext:r&&r.toString()||"",dn:o||[],cn:s||""}}})):m.phone={sip:s.SIP||"",normal:s.NUMBER||"",work:s.WORK&&s.WORK.NUMBER||"",home:s.HOME&&s.HOME.NUMBER||""}),a&&(m.intro=a),c&&(m.ext={cmpy:c.CMPY||"",job:c.JOB||"",manager:c.MANAGER||"",adr:c.ADR||"",dept:c.DEPT||"",wkcode:c.WKCODE||"",wkphone:c.WKPHONE||"",pronoun:c.PRONOUN||"",audit:"true"===c.AUDIT,audit_t:c.AUDIT_T||"",platform:c.PLATFORM||"",info:c.INFO&&JSON.parse(c.INFO)||""},c.WKPHONES&&c.WKPHONES.ITEM)){var f=c.WKPHONES.ITEM;Array.isArray(f)||(f=[f]),f=f.map((function(e){return{label:e._label||"",text:e.__text||"",code:e._code||"",country:e._country||"",type:e._type||"",verified:"true"==e._verified}})),m.wkphones=f}return l&&(m.userType=l),m.wkloc=h||"0",m},o.Strophe.xml2json=function(e){return N.xml2json(e)},o.Strophe.json2xml=function(e){var t=N.json2xml(e).childNodes;return t.length?t[0]:null},o.Strophe.log=function(e,t){o.Strophe.showLog},o.Strophe.hmacSHA256=a.a,o.Strophe.Base64=u.a,o.Strophe.Utf8=d.a,t.default=o.Strophe},function(e,t,n){var i;i=function(e){!function(){var t=e,n=t.lib.Base,i=t.enc.Utf8;t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}()},e.exports=i(n(1))},function(e,t,n){var i;i=function(e){return function(t){var n=e,i=n.lib,r=i.WordArray,o=i.Hasher,s=n.algo,a=[],c=[];!function(){function e(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)(function(e){for(var n=t.sqrt(e),i=2;i<=n;i++)if(!(e%i))return!1;return!0})(n)&&(i<8&&(a[i]=e(t.pow(n,.5))),c[i]=e(t.pow(n,1/3)),i++),n++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],d=n[6],h=n[7],m=0;m<64;m++){if(m<16)u[m]=0|e[t+m];else{var f=u[m-15],p=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,g=u[m-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;u[m]=p+u[m-7]+v+u[m-16]}var _=i&r^i&o^r&o,y=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),N=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[m]+u[m];h=d,d=l,l=a,a=s+N|0,s=o,o=r,r=i,i=N+(y+_)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=t.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=o._createHelper(l),n.HmacSHA256=o._createHmacHelper(l)}(Math),e.SHA256},e.exports=i(n(1))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n}])}(t),t.exports}()),p={jid:"",xmppToken:"",XMPPServer:"",PINGServer:"",enableFetchCoworkerGroup:!1,enableFetchZoomRoomGroup:!0,web:{option:656631},maxReconnectAttempt:10,reconectIntervalMultiplier:1.1,reconnectInterval:4e3,pingInterval:3e4,pingTimeout:1e3,queryVcardInterval:18e6,subscribePresenceInterval:3e5,log:{logLevel:[],logModule:[]},deviceName:"",PWATokenUrl:"",XMSDomain:""},g=function e(n){var i=this;this.module=void 0,this.validate=function(t){return e.logLevels.includes(t)&&e.logModules.includes(i.module)},this.debug=function(){if(i.validate(t.WebimLogLevel.DEBUG)){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(e=console).debug.apply(e,["["+i.module+"]"].concat(r))}},this.info=function(){if(i.validate(t.WebimLogLevel.INFO)){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(e=console).info.apply(e,["["+i.module+"]"].concat(r))}},this.warn=function(){if(i.validate(t.WebimLogLevel.WARN)){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(e=console).warn.apply(e,["["+i.module+"]"].concat(r))}},this.error=function(){if(i.validate(t.WebimLogLevel.ERROR)){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(e=console).error.apply(e,["["+i.module+"]"].concat(r))}},this.module=n};g.logLevels=[],g.logModules=[],g.setLogLevels=function(e){g.logLevels=e},g.setLogModules=function(e){g.logModules=e},t.WebimPresenceType=void 0,(c=t.WebimPresenceType||(t.WebimPresenceType={})).dnd="dnd",c.presenting="presenting",c.zoommeeting="zoommeeting",c.pbx="pbx",c.calendar="calendar",c.available="available",c.away="away",c.offline="offline",c.mobile="mobile",c.busy="busy",t.InviteContactResponseType=void 0,(u=t.InviteContactResponseType||(t.InviteContactResponseType={})).INVITE_MESSAGE_SEND_SUCCESS="INVITE_MESSAGE_SEND_SUCCESS",u.INVITE_CONTACT_BE_ACCEPTED="INVITE_CONTACT_BE_ACCEPTED",u.INVITE_CONTACT_BE_DECLINED="INVITE_CONTACT_BE_DECLINED",u.INVITE_CONTACT_OTHERS_INVITE_ME="INVITE_CONTACT_OTHERS_INVITE_ME",u.INVITE_CONTACT_ROSTER_ADD="INVITE_CONTACT_ROSTER_ADD",u.INVITE_CONTACT_ROSTER_REMOVE="INVITE_CONTACT_ROSTER_REMOVE",function(e){e.ADD="add",e.REMOVE="remove"}(l||(l={})),function(e){e.pwa="ZoomChat_pc_pwa",e.pc="ZoomChat_pc",e.mobile="ZoomChat_mobile",e.pad="ZoomChat_pad",e.pzr="ZoomChat_pzr"}(d||(d={})),function(e){e.offline="offline",e.away="away",e.dnd="dnd",e.online="available",e.xa="xa"}(h||(h={})),function(e){e.NA="NA",e.ZoomMeeting="ZM",e.Presenting="ZP",e.Meeting="M",e.Pbx="PBX",e.Busy="BUSY"}(m||(m={}));var v,_,y,N=function(){},b=new g(t.WebimModuleName.presence),C=function(){function e(e){var n=this;this.connection=void 0,this.dispatch=void 0,this.presencesMap=void 0,this.deviceList=void 0,this.inviteContactResolve=void 0,this.deleteContactResolve=void 0,this.onReciveDeviceList=function(e){void 0===e&&(e=[]);var i=p.jid,r=e.map((function(e){var t=e.resource,r=n.presencesMap.get(i),o=a({},e);if(null!=r&&r.resources[t]){var s,c=null==r?void 0:r.resources[t],u=c.meetingInfo;u&&(o.meetingInfo=u);var l=n.getPresenceType(((s={})[t]=c,s));l&&(o.presenceType=l)}return o}));n.deviceList=r,n.dispatch({type:t.WebimEventType.DeviceListChange,data:r})},this.onIqPresenceChange=function(e){void 0===e&&(e=[]),b.debug("receive iq presences",e);var i=[];e.forEach((function(e){var r=e.jid,o=e.mobile,s=e.res,c=void 0===s?[]:s,u=n.presencesMap.get(r)||{presenceType:t.WebimPresenceType.offline,lastSubscribeTime:Date.now(),resources:{}};c.forEach((function(e){u.resources[e.resource]||(u.resources[e.resource]={show:h.offline,status:m.NA,resource:e.resource}),u.resources[e.resource]=a({},u.resources[e.resource],e)})),String(o)===String(1)&&(u.resources[d.mobile]={resource:d.mobile,show:h.online,status:m.NA});var l=n.getPresenceType(u.resources);l&&(u.presenceType=l),n.presencesMap.set(r,u),i.push(r)})),n.notifyPresenceChange(i)},this.onPresenceChange=function(e){b.debug("receive presence change",e);var i=e.from,r=e.show,o=e.status,s=e.isManual,c=e.meetingInfo,u=e.inviteContactResponse;if(u)u.type===t.InviteContactResponseType.INVITE_MESSAGE_SEND_SUCCESS?n.inviteContactResolve&&n.inviteContactResolve(u):u.type!==t.InviteContactResponseType.INVITE_CONTACT_BE_ACCEPTED&&u.type!==t.InviteContactResponseType.INVITE_CONTACT_BE_DECLINED&&u.type!==t.InviteContactResponseType.INVITE_CONTACT_OTHERS_INVITE_ME||n.dispatch({type:t.WebimEventType.InviteContactChange,data:u});else{var l=f.getResourceFromJid(i),d=f.getBareJidFromJid(i);if(l){var h={resource:l,show:r,status:o,isManual:s};c&&(h.meetingInfo=c);var m=n.presencesMap.get(d)||{presenceType:t.WebimPresenceType.offline,lastSubscribeTime:Date.now(),resources:{}};m.resources[l]=h;var g=n.getPresenceType(m.resources);if(g&&(m.presenceType=g),n.presencesMap.set(d,m),n.notifyPresenceChange([d]),d===p.jid&&n.deviceList.length>0){var v,_=n.getPresenceType(((v={})[l]=h,v)),y=!1,N=n.deviceList.map((function(e){if(e.resource===l){y=!0;var t=a({},e);return _&&(t.presenceType=_),c?t.meetingInfo=c:delete t.meetingInfo,t}return e}));y?(n.deviceList=N,n.dispatch({type:t.WebimEventType.DeviceListChange,data:N})):n.queryDevice()}}}},this.onIQDurationChange=function(e){b.debug("receive duration change",e),n.dispatch({type:t.WebimEventType.DurationChange,duration:e})},this.onRosterListChange=function(e){b.debug("on RosterList Change",e);var i={add:t.InviteContactResponseType.INVITE_CONTACT_ROSTER_ADD,remove:t.InviteContactResponseType.INVITE_CONTACT_ROSTER_REMOVE};Object.keys(i).includes(e.type)&&("remove"===e.type&&n.deleteContactResolve&&n.deleteContactResolve(e),n.dispatch({type:t.WebimEventType.InviteContactChange,data:{type:i[e.type],roster:e}}))},this.notifyPresenceChange=function(e){void 0===e&&(e=[]),b.debug("notify presence change");var i=e.map((function(e){var i;return{jid:e,presenceType:(null==(i=n.presencesMap.get(e))?void 0:i.presenceType)||t.WebimPresenceType.offline}}));n.dispatch({type:t.WebimEventType.PresenceChange,data:i})},this.onConnectionChange=function(e){t.WebimStatus.CONNECTED===e.status&&(n.queryIqPresence(),n.online(),n.queryDuration())},this.subscribe=function(e){var t,i;e&&(null==(t=n.connection)||null==(i=t.zConnection)||i.presence.subscribe([a({},e)]))},this.queryIqPresence=function(){var e,t;null==(e=n.connection)||null==(t=e.zConnection)||t.iqpresence.queryPresence()},this.checkIfNeedToSubscribePresence=function(e){var i=n.presencesMap.get(e);i||(i={lastSubscribeTime:-1,presenceType:t.WebimPresenceType.offline,resources:{}});var r=i.lastSubscribeTime,o=void 0===r?-1:r,s=n.connection.syncTime,a=s.serverTime,c=s.localTime,u=Date.now(),l=-1,d=p.subscribePresenceInterval;return(-1===o||u-o>=d)&&(l=Number(a)+u-Number(c)+d,i.lastSubscribeTime=u),-1!==l?(n.presencesMap.set(e,i),{jid:e,expireTime:l}):null},this.determinePresenceType=function(e){var n=e[0],i=e[1],r=e[2],o=e[3];return n.some((function(e){return e.show===h.xa}))||i.some((function(e){return e.show===h.xa}))||r.some((function(e){return e.show===h.xa}))||o.some((function(e){return e.show===h.xa}))?t.WebimPresenceType.dnd:n.some((function(e){return e.show===h.dnd&&e.status===m.Presenting}))||i.some((function(e){return e.show===h.dnd&&e.status===m.Presenting}))||r.some((function(e){return e.show===h.dnd&&e.status===m.Presenting}))||o.some((function(e){return e.show===h.dnd&&e.status===m.Presenting}))?t.WebimPresenceType.presenting:n.some((function(e){return e.show===h.dnd&&e.status===m.ZoomMeeting}))||i.some((function(e){return e.show===h.dnd&&e.status===m.ZoomMeeting}))||r.some((function(e){return e.show===h.dnd&&e.status===m.ZoomMeeting}))||o.some((function(e){return e.show===h.dnd&&e.status===m.ZoomMeeting}))?t.WebimPresenceType.zoommeeting:n.some((function(e){return e.show===h.dnd&&e.status===m.Pbx}))||i.some((function(e){return e.show===h.dnd&&e.status===m.Pbx}))||r.some((function(e){return e.show===h.dnd&&e.status===m.Pbx}))||o.some((function(e){return e.show===h.dnd&&e.status===m.Pbx}))?t.WebimPresenceType.pbx:n.some((function(e){return e.show===h.dnd&&e.status===m.Meeting}))||i.some((function(e){return e.show===h.dnd&&e.status===m.Meeting}))||r.some((function(e){return e.show===h.dnd&&e.status===m.Meeting}))||o.some((function(e){return e.show===h.dnd&&e.status===m.Meeting}))?t.WebimPresenceType.calendar:n.some((function(e){return e.show===h.away&&e.status===m.Busy}))||i.some((function(e){return e.show===h.away&&e.status===m.Busy}))||r.some((function(e){return e.show===h.away&&e.status===m.Busy}))||o.some((function(e){return e.show===h.away&&e.status===m.Busy}))?t.WebimPresenceType.busy:n.some((function(e){return e.show===h.online}))?t.WebimPresenceType.available:n.some((function(e){return e.show===h.away}))?t.WebimPresenceType.away:i.some((function(e){return e.show===h.online}))||r.some((function(e){return e.show===h.online}))||o.some((function(e){return e.show===h.online}))?t.WebimPresenceType.mobile:(o.some((function(e){return e.show===h.away}))||n.some((function(e){return e.show===h.offline}))||i.some((function(e){return e.show===h.offline}))||r.some((function(e){return e.show===h.offline}))||o.some((function(e){return e.show===h.offline})),t.WebimPresenceType.offline)},this.getPresenceResourceWithManuallySetPresence=function(e){return e.map((function(e){return e.filter((function(e){return e.isManual}))}))},this.connection=e.connection,this.dispatch=e.dispatch,this.presencesMap=new Map,this.deviceList=[],this.inviteContactResolve=N,this.deleteContactResolve=N}var n=e.prototype;return n.init=function(){var e,t,n,i,r,o,s,a,c,u;b.debug("init"),null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.addIQPresenceCB(this.onIqPresenceChange),null==(n=this.connection)||null==(i=n.zConnection)||i.iqpresence.addIQDeviceCB(this.onReciveDeviceList),null==(r=this.connection)||null==(o=r.zConnection)||o.presence.addPresenceHandle(this.onPresenceChange),null==(s=this.connection)||null==(a=s.zConnection)||a.presence.addIQHandle(this.onIQDurationChange),null==(c=this.connection)||null==(u=c.zConnection)||u.presence.addRosterHandle(this.onRosterListChange)},n.uninit=function(){var e,t,n,i,r,o,s,a,c,u;b.debug("uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.addIQPresenceCB(null),null==(n=this.connection)||null==(i=n.zConnection)||i.presence.addPresenceHandle(null),null==(r=this.connection)||null==(o=r.zConnection)||o.iqpresence.addIQDeviceCB(null),null==(s=this.connection)||null==(a=s.zConnection)||a.presence.addIQHandle(null),null==(c=this.connection)||null==(u=c.zConnection)||u.presence.addRosterHandle(null)},n.queryPresence=function(e){var t;if(!e)return null;var n=this.checkIfNeedToSubscribePresence(e);return n&&(b.debug("subscribe presence to server",e),this.subscribe(n)),{jid:e,presenceType:null==(t=this.presencesMap.get(e))?void 0:t.presenceType}},n.changePresence=function(e,n,i){switch(e){case t.WebimPresenceType.offline:this.offline();break;case t.WebimPresenceType.zoommeeting:this.inMeeting(i);break;case t.WebimPresenceType.presenting:this.isPresenting();break;case t.WebimPresenceType.available:this.online(n);break;case t.WebimPresenceType.pbx:this.inPhoneCall();break;case t.WebimPresenceType.away:this.away(n);break;case t.WebimPresenceType.dnd:this.dnd();break;case t.WebimPresenceType.busy:this.busy(n)}},n.getPresenceType=function(e){if(!e)return null;var t=Object.values(e),n=[t.filter((function(e){return e.resource.startsWith(d.pc)})),t.filter((function(e){return e.resource.startsWith(d.mobile)})),t.filter((function(e){return e.resource.startsWith(d.pad)})),t.filter((function(e){return e.resource.startsWith(d.pzr)}))],i=this.getPresenceResourceWithManuallySetPresence(n);return i.flat().length>0?this.determinePresenceType(i):this.determinePresenceType(n)},n.online=function(e){var t,n;void 0===e&&(e=!1),null==(t=this.connection)||null==(n=t.zConnection)||n.presence.online(e)},n.offline=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.offline()},n.inMeeting=function(e){var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.inMeeting(e)},n.isPresenting=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.isPresenting()},n.inPhoneCall=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.inPhoneCall()},n.away=function(e){var t,n;void 0===e&&(e=!1),null==(t=this.connection)||null==(n=t.zConnection)||n.presence.away(e)},n.duration=function(e){var t,n;null==(t=this.connection)||null==(n=t.zConnection)||n.presence.duration(e)},n.dnd=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.dnd()},n.busy=function(e){var t;void 0===e&&(e=!1),null==(t=this.connection)||t.zConnection.presence.busy(e)},n.queryDuration=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.presence.queryDuration()},n.queryDevice=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.iqpresence.queryDevice()},n.inviteContactByEmail=function(e){var t,n,i=this;return null==(t=this.connection)||null==(n=t.zConnection)||n.presence.inviteContactByEmail(e),new Promise((function(e){i.inviteContactResolve=e}))},n.deleteContactByJid=function(e){var t,n,i=this;return null==(t=this.connection)||null==(n=t.zConnection)||n.presence.deleteContactByJid(e),new Promise((function(e){i.deleteContactResolve=e}))},e}(),T=new g(t.WebimModuleName.message);!function(e){e.Invite="invite",e.OldDecline="old_decline",e.Accept="accept",e.Decline="decline",e.Cancel="cancel"}(v||(v={})),function(e){e.SyncLoginInfo="1"}(_||(_={})),t.InviteContactSyncMessageType=void 0,(y=t.InviteContactSyncMessageType||(t.InviteContactSyncMessageType={})).SUBSENT="subsent",y.DOACCEPT="doaccept",y.SUBSCRIBED="subscribed",y.SUBREJECT="subreject",y.UNSUBSCRIBED="unsubscribed";var I,S,E,x=function(){function e(e){var n=this;this._recentChatList=void 0,this.connection=void 0,this.dispatch=void 0,this.onMessageHanlder=function(e){var i,r,o=e.zmext,s=e.zext_call,a=e.zmsync,c=e.zmtask,u=e.zext_subsync;if(o&&n.sendAck(e.zmext._t,e._from),s){var l=n.formatReceivedInvitationMessage(e);n.dispatch({type:t.WebimEventType.MessageChange,data:l})}a&&a._type===_.SyncLoginInfo&&(null==(i=n.connection)||null==(r=i.zConnection)||r.iqpresence.queryDevice(),n.dispatch({type:t.WebimEventType.LoginOtherDevice})),u&&c&&"4099"===c._feature&&o&&"201"===o.msg_type&&n.handleInviteContactReceivedSyncMessage(e)},this.onRecentChatHandler=function(e){void 0===e&&(e=[]),n.dispatch({type:t.WebimEventType.RecentChat,data:e})},this.sendMessage=function(e){var t,i;return null==(t=n.connection)||null==(i=t.zConnection)?void 0:i.Messaging.sendMessage(e)},this.sendAck=function(e,t){var i,r;null==(i=n.connection)||null==(r=i.zConnection)||r.ackmessage.ack(e,t)},this.sendRead=function(e,t,i){var r,o;null==(r=n.connection)||null==(o=r.zConnection)||o.ackmessage.read({from:e,group:t,items:i,action:"reset"})},this.composeInvitationMessage=function(e){var t=e.action,n=void 0===t?"":t,i=e.fromJid,r=void 0===i?"":i,o=e.toJid,s=void 0===o?"":o,a=e.fromName,c=void 0===a?"":a,u=e.raw,l=void 0===u?"":u,d=e.srcDeviceId,h=void 0===d?"":d,m=e.caption,p=void 0===m?"":m,g=e.dstDeviceId,v=void 0===g?"":g,_=e.name,y=void 0===_?"":_,N=e.type,b=void 0===N?"chat":N,C=e.notifyOtherDevices,T=void 0===C?0:C,I=e.subType,S=void 0===I?void 0:I,E=e.msgType,x=void 0===E?void 0:E,O={_xmlns:"jabber:client",_from:r,_type:b,_to:s,active:{_xmlns:"http://jabber.org/protocol/chatstates"},zmext:{obj:{_f:6,_st:0},from:{_n:c,_res:f.Resource},to:"",visible:!1},zext_call:{action:n,raw:l,src_deviceid:h,caption:p,notify_other_devices:T},zmtask:{_feature:3}};return v&&(O.zext_call.dst_deviceid=v),"groupchat"===b&&(O.zext_call.group_name=y),void 0!==S&&(O.zext_call.subtype=S),void 0!==x&&(O.zmext.msg_type=x),O},this.sendInviteContactSyncMessage=function(e){var t,i,r=n.composeInviteContactSyncMessage(e);return null==(t=n.connection)||null==(i=t.zConnection)?void 0:i.Messaging.sendInviteContactSyncMessage({message:r})},this._recentChatList=[],this.connection=e.connection,this.dispatch=e.dispatch}var n=e.prototype;return n.init=function(){var e,t,n,i;T.debug("message -> init"),null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.addMessageCB(this.onMessageHanlder),null==(n=this.connection)||null==(i=n.zConnection)||i.Messaging.addRecentChatCB(this.onRecentChatHandler)},n.uninit=function(){var e,t,n,i;T.debug("message -> uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.addMessageCB(null),null==(n=this.connection)||null==(i=n.zConnection)||i.Messaging.addRecentChatCB(null)},n.invite=function(e){T.debug("message -> invite",e);var t=e.jid,n=e.meetingNo,i=e.password,r=e.displayName,o=e.caption,s=e.toJid,a=e.iak,c=e.credential,u=e.type,l=e.name,d=f._Conection_Id_,h=this.formatInvitationRaw({meetingNo:n,nsCommand:0,userId:t,screenName:r,password:i,iak:a,credential:c}),m=this.composeInvitationMessage({fromJid:t,toJid:s,fromName:r,action:v.Invite,raw:h,srcDeviceId:d,caption:o,type:u,name:l,msgType:55});return this.sendMessage({message:m})},n.acceptInvitation=function(e){T.debug("message -> invite","accept invitation",e);var t=e.meetingNo,n=e.toJid,i=e.toName,r=void 0===i?"":i,o={meetingNo:t,meetingOption:6,nsCommand:2,userId:n,deviceId:f._Conection_Id_};o=this.formatInvitationRaw(o);var s={action:v.Accept,fromJid:n.split("/")[0],toJid:n,raw:o,fromName:r,srcDeviceId:f._Conection_Id_,notifyOtherDevices:1};s=this.composeInvitationMessage(s),this.sendMessage({message:s})},n.declineInvitation=function(e){T.debug("message -> invite","decline invitation",e);var t=e.meetingNo,n=e.fromJid,i=e.toJid,r=e.toName,o=void 0===r?"":r,s=e.isTimeoutDecline,a={meetingNo:t,meetingOption:6,nsCommand:3,userId:i,deviceId:f._Conection_Id_};a=this.formatInvitationRaw(a);var c={action:v.Decline,fromJid:i,toJid:n,raw:a,fromName:o,srcDeviceId:f._Conection_Id_,notifyOtherDevices:1};s&&(c.subType=1),c=this.composeInvitationMessage(c),this.sendMessage({message:c})},n.cancelInvitation=function(e){T.debug("message -> invite","cancel invitation",e);var t=e.meetingNo,n=e.jid,i=e.toJid,r=e.toName,o=void 0===r?"":r,s=e.name,a=e.type,c={meetingNo:t,meetingOption:6,nsCommand:4,userId:n,deviceId:f._Conection_Id_},u={action:"cancel",fromJid:n,toJid:i,raw:c=this.formatInvitationRaw(c),name:s,type:a,fromName:o,srcDeviceId:f._Conection_Id_,notifyOtherDevices:1};u=this.composeInvitationMessage(u),this.sendMessage({message:u})},n.queryRecentChat=function(){var e,t;null==(e=this.connection)||null==(t=e.zConnection)||t.Messaging.queryRecentChat()},n.getRecentChatList=function(){return this._recentChatList.slice()},n.onConnectionChange=function(e){},n.formatReceivedInvitationMessage=function(e){var t=e.zext_call,n=t.action,i=t.caption,r=t.raw,o=t.src_deviceid,s=t.subtype,a=t.lcp,c=e.zmext,u=c.from._res,l=c._expire_t,d=void 0===l?-1:l,h=c._t,m=void 0===h?-1:h,f=e.delay,p=e._from,g=e._to,v=r.split(";"),_=v[2]||"",y=v[3]||0,N=v[7]||"";return{action:n,meetingNo:_,meetingOption:y,password:v[8]||"",caption:i,fromJid:p,fromName:N,fromResource:u,fromDeviceId:o,isTimeoutDecline:s,toJid:g,expireTime:d,receiveTime:m,delay:f,__raw__:r,iak:v[15]||"",credential:v[16]||"",lcp:a}},n.formatInvitationRaw=function(e){var t=e.meetingNo,n=e.nsCommand,i=e.userId,r=e.screenName,o=void 0===r?"":r,s=e.deviceId,a=void 0===s?"":s,c=e.password,u=void 0===c?"":c,l=e.meetingOption,d=void 0===l?"":l,h=e.scheduleOption,m=void 0===h?"":h,f=e.isPhoneCall,p=void 0===f?"":f,g=e.callId,v=void 0===g?"":g,_=e.groupName,y=void 0===_?"":_,N=e.groupMemberCount,b=void 0===N?"":N,C=e.groupId,T=void 0===C?"":C,I=e.iak,S=void 0===I?"":I,E=e.credential,x=void 0===E?"":E;return["","",t,d,n,i,a,o=o.replace(/;/g,","),u,m,p,v,y,b,T,S,x].join(";")},n.handleInviteContactReceivedSyncMessage=function(e){var n=e.zext_subsync,i=n._action,r=n.peerjid,o=n.peername,s=n._peeremail;this.dispatch({type:t.WebimEventType.InviteContactSyncMessage,data:{action:i,jid:r,name:o,email:s,message:e}})},n.composeInviteContactSyncMessage=function(e){var t=e.action,n=e.inviteeJid,i=e.inviteeEmail,r=e.inviteeName;return{active:{_xmlns:"http://jabber.org/protocol/chatstates"},zmext:{from:{_n:e.inviterName,_res:""},msg_type:"201",to:"",visible:"false"},zext_subsync:{_xmlns:"zoom:sub:ext",_action:t,_peerjid:n,_peername:r,_peeremail:i,_error:"0",_extension:"0"},zmtask:{_xmlns:"zoom:imcmd",_feature:"4099"},_xmlns:"jabber:client",_from:"",_to:"",_id:"",_type:"chat"}},e}(),O=new g(t.WebimModuleName.roster);!function(e){e[e.Normal=0]="Normal",e[e.Addon=1]="Addon",e[e.ZoomRoom=2]="ZoomRoom"}(I||(I={})),function(e){e[e.Default=0]="Default",e[e.Coworker=1]="Coworker",e[e.ZoomRoom=60]="ZoomRoom",e[e.PersonGroup=500]="PersonGroup"}(S||(S={})),function(e){e[e.ROSTER_VERSION_CB=4]="ROSTER_VERSION_CB",e[e.ROSTER_ITEMS_CB=5]="ROSTER_ITEMS_CB",e[e.ROSTER_ITEM_DEL_CB=6]="ROSTER_ITEM_DEL_CB",e[e.ROSTER_ITEM_ADD_CB=7]="ROSTER_ITEM_ADD_CB",e[e.ROSTER_BLOCKED_LIST=100]="ROSTER_BLOCKED_LIST"}(E||(E={}));var R,w,A,M=function(){function e(e){var n=this;this.groupsMap=void 0,this.contactsMap=void 0,this.connection=void 0,this.dispatch=void 0,this.zStropherRosterHandler=function(e,t){if(e===E.ROSTER_VERSION_CB&&n.onGetGroupVersionFromServer(t),e===E.ROSTER_ITEMS_CB){var i=t,r=i.chunk,o=i.group,s=i.groups,a=void 0===s?[]:s;try{n.onGetRosterFromServer(o?[o].concat(a):a)}catch(e){}n.queryNextRosterPage(r)}e===E.ROSTER_BLOCKED_LIST&&n.onGetBlockedRosterList(t)},this.queryGroupVersion=function(){var e,t;O.debug("roster -> query group version"),null==(e=n.connection)||null==(t=e.zConnection)||t.roster.queryGroupInfos()},this.queryNextRosterPage=function(e){var t,i;/:\d+$/.test(e)&&(null==(t=n.connection)||null==(i=t.zConnection)||i.roster.queryChunk(e))},this.onGetGroupVersionFromServer=function(e){n.dispatch({type:t.WebimEventType.ServerGroups,data:e})},this.onGetRosterFromServer=function(e){if(0!==e.length){var t=[];e.forEach((function(e){var i=e.id,r=void 0===i?"default":i,o=e.version,s=e.name,a=e.total,c=e.first,u=e.option,l=e.items;e.adds,e.deletes,e.updates,s||(s=l&&l[0]&&l[0].gname?l[0].gname+"##"+S.Default+"##"+r:r+"##"+S.Default+"##"+r);var d=n.formatGroupName(s),h=d[0],m=d[1],f=d[2],p=n.groupsMap.get(f);p&&!c||(p={id:f,type:m,name:h,total:a,option:u,version:o,items:[]});var g=[];null==l||l.forEach((function(e){var t,i=e.fname,r=e.lname,o=e.jid,s=e.type,a=e.cmd;null==(t=p)||t.items.push(o),n.contactsMap.set(o,Object.assign({},n.contactsMap.get(o),{jid:o,type:s,cmd:a,fname:i,lname:r})),g.push(o)})),O.debug("roster -> receive group member chunk",h,p),n.groupsMap.set(f,p),t.push([f,g])})),n.notifyGroupChange(t)}},this.notifyGroupChange=function(e){if(O.debug("roster -> notify group change",e),0!==e.length){var i=e.map((function(e){var t=e[0],i=e[1],r=n.groupsMap.get(t);return r?a({},r,{items:i.map((function(e){return n.transformRosterToContact(n.contactsMap.get(e))})).filter((function(e){return null!==e}))}):null})).filter((function(e){return e}));n.dispatch({type:t.WebimEventType.GroupChange,data:i})}},this.fetchBlockList=function(){var e,t;return null==(e=n.connection)||null==(t=e.zConnection)?void 0:t.roster.fetchBlockList()},this.onGetBlockedRosterList=function(e){n.dispatch({type:t.WebimEventType.RosterBlocklist,data:e})},this.transformRosterToContact=function(e){if(!e)return null;var t=e.jid,n=e.type,i=void 0===n?I.Normal:n,r=e.fname,o=void 0===r?"":r,s=e.lname,a=void 0===s?"":s,c=e.cmd;return{jid:t,type:i,cmd:void 0===c?"":c,firstName:o,lastName:a}},this.formatGroupName=function(e){var t=e.match(/^(.+)##(.+)##(.+)$/);return t?(t[0],[t[1],t[2],t[3]]):e.split("##")},this.groupsMap=new Map,this.contactsMap=new Map,this.connection=e.connection,this.dispatch=e.dispatch}var n=e.prototype;return n.init=function(){var e,t;O.debug("roster -> init"),null==(e=this.connection)||null==(t=e.zConnection)||t.roster.addRosterHandler(this.zStropherRosterHandler)},n.uninit=function(){var e,t;O.debug("roster -> uninit"),null==(e=this.connection)||null==(t=e.zConnection)||t.roster.addRosterHandler(null)},n.queryGroupMember=function(e,t,n){var i,r;void 0===e&&(e=[]),void 0===t&&(t=1),void 0===n&&(n=1),O.debug("roster -> query group member",e),e.length>0&&(null==(i=this.connection)||null==(r=i.zConnection)||r.roster.queryGroups({groups:e,chunk:t,directory:n}))},n.filterGroups=function(e){var t=this;void 0===e&&(e=[]);var n=p.enableFetchCoworkerGroup,i=p.enableFetchZoomRoomGroup;return e.filter((function(e){var r=!0;return t.isCoworkersGroup(e)&&(r=r&&n),t.isZoomRoomGroup(e)&&(r=r&&i),r}))},n.diffGroups=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);var n=[],i=[],r=[],o=t.filter((function(t){return!e.find((function(e){return e.id===t.id}))}));return e.forEach((function(e){var o=t.find((function(t){return t.id===e.id}));o||r.push(e),o&&o.version===e.version&&i.push(o),o&&o.version!==e.version&&n.push(o)})),{removed:o,updated:n,remained:i,added:r}},n.onConnectionChange=function(e){e.status===t.WebimStatus.CONNECTED&&this.queryGroupVersion()},n.isContactZoomRoom=function(e){var t=this,n=e.type,i=e.jid;if("2"===String(n))return!0;var r=Array.from(this.groupsMap.values()).find((function(e){return t.isZoomRoomGroup(e)}));return!!r&&r.items.indexOf(i)>-1},n.isCoworkersGroup=function(e){return String(e.type)===String(1)},n.isZoomRoomGroup=function(e){var t=e.id,n=void 0===t?"":t,i=e.type;return"60"===String(void 0===i?"":i)||0===String(n).indexOf("zm.")},e}(),k=new g(t.WebimModuleName.vcard),D=function(e){var n=this;this.connection=void 0,this.dispatch=void 0,this.vcardsMap=void 0,this.init=function(){var e,t;k.debug("vcard init"),null==(e=n.connection)||null==(t=e.zConnection)||t.vcard.addVCardHandler(n.onVcardChangeHandler)},this.uninit=function(){var e,t;k.debug("vcard uninit"),null==(e=n.connection)||null==(t=e.zConnection)||t.vcard.addVCardHandler(null)},this.onVcardChangeHandler=function(e){var t=(e||{}).jid;t&&(n.vcardsMap.set(t,Object.assign({},n.vcardsMap.get(t),e)),n.notifyVcardChange([t]))},this.notifyVcardChange=function(e){n.dispatch({type:t.WebimEventType.VcardChange,data:e.map((function(e){return a({},n.vcardsMap.get(e))})).filter((function(e){return e}))})},this.queryVcard=function(e){var t=e.jid,i=e.forceFetch,r=void 0!==i&&i;if(t){var o=n.vcardsMap.get(t);o||(o={jid:"",displayName:"",lastName:"",firstName:"",picUrl:"",email:"",organization:{id:"",domain:""},signature:"",phone:{sip:"",normal:"",work:"",home:""},lastQueryTime:-1},n.vcardsMap.set(t,o));var s=p.queryVcardInterval,c=o.lastQueryTime;return(Date.now()-c>=s||r)&&n.queryVcardFromServer(t),a({},o)}},this.queryAllVcardsByForce=function(){Array.from(n.vcardsMap.keys()).forEach((function(e){n.queryVcardFromServer(e)}))},this.queryVcardFromServer=function(e){var t=p.xmppToken,i=(n.connection||{}).secret;if(t&&i){var r,o,s=n.vcardsMap.get(e);s&&(s.lastQueryTime=Date.now(),n.vcardsMap.set(e,s)),null==(r=n.connection)||null==(o=r.zConnection)||o.vcard.query(e)}},this.getVcard=function(e){return e&&a({},n.vcardsMap.get(e))},this.onConnectionChange=function(e){t.WebimStatus.CONNECTED===e.status&&n.queryAllVcardsByForce()},this.connection=e.connection,this.dispatch=e.dispatch,this.vcardsMap=new Map},q=new g(t.WebimModuleName.room),L=function(e){var n=this;this.connection=void 0,this.dispatch=void 0,this.requestedMap=void 0,this.init=function(){var e,t;q.debug("room init"),null==(e=n.connection)||null==(t=e.zConnection)||t.room.addRoomHandler(n.onRoomHandler)},this.uninit=function(){var e,t;q.debug("vcard uninit"),null==(e=n.connection)||null==(t=e.zConnection)||t.room.addRoomHandler(null)},this.unhideRoom=function(e){var t,i,r=null==(t=n.connection)||null==(i=t.zConnection)?void 0:i.room.changeRoomOption(e,{option:"0",e2e:"0",desc:"",announcer:"",unhidden:1});return r?new Promise((function(e,t){n.requestedMap.set(r,{resolve:e,reject:t})})).finally((function(){n.requestedMap.delete(r)})):Promise.reject("internal error")},this.notify=function(){n.dispatch({type:t.WebimEventType.RoomChange,data:null})},this.onRoomHandler=function(e){var t=e.id,i=e.type,r=e.data,o=n.requestedMap.get(t);if(o){var s=o.resolve,a=o.reject;"result"===i?s(r):a("error")}},this.onConnectionChange=function(e){t.WebimStatus.CONNECTED,e.status},this.connection=e.connection,this.dispatch=e.dispatch,this.requestedMap=new Map},P=new g(t.WebimModuleName.connection);!function(e){e[e.ERROR=0]="ERROR",e[e.CONNECTING=1]="CONNECTING",e[e.CONNFAIL=2]="CONNFAIL",e[e.AUTHENTICATING=3]="AUTHENTICATING",e[e.AUTHFAIL=4]="AUTHFAIL",e[e.CONNECTED=5]="CONNECTED",e[e.DISCONNECTED=6]="DISCONNECTED",e[e.DISCONNECTING=7]="DISCONNECTING",e[e.ATTACHED=8]="ATTACHED",e[e.REDIRECT=9]="REDIRECT",e[e.CONNTIMEOUT=10]="CONNTIMEOUT"}(R||(R={})),t.WebimStatus=void 0,(w=t.WebimStatus||(t.WebimStatus={})).INIT="INIT",w.ERROR="ERROR",w.CONNECTING="CONNECTING",w.RECONNECTING="RECONNECTING",w.CONNFAIL="CONNFAIL",w.AUTHENTICATING="AUTHENTICATING",w.AUTHFAIL="AUTHFAIL",w.CONNECTED="CONNECTED",w.DISCONNECTED="DISCONNECTED",w.DISCONNECTING="DISCONNECTING",w.CONNTIMEOUT="CONNTIMEOUT",t.WebimStatusErrorType=void 0,(A=t.WebimStatusErrorType||(t.WebimStatusErrorType={})).CONFLICT="conflict",A.UNKNOWN="unknown",A.REVOKE_TOKEN="revoke-token";var H=function(){function e(e){var n=this,i=e.dispatch,r=e.deviceName;this.statusInfo={status:t.WebimStatus.INIT,statusInfo:"",networkConnected:navigator.onLine,willReconnect:!0},this.moduleMap=void 0,this.dispatch=void 0,this.zConnection=void 0,this.secret=void 0,this.syncTime=void 0,this.deviceName=void 0,this.pingErrorTimes=0,this.pingErrorMaxTimes=3,this.stanzaHandler=null,this.reconnectAttempts=0,this.canReconnect=!0,this.pingTimer=-1,this.connectTimer=-1,this.connect=function(){P.debug("connect by user"),n.statusInfo.status===t.WebimStatus.INIT&&(n.reconnectAttempts=0,n.canReconnect=!0,n.doConnect())},this.doConnect=function(){var e;self.clearTimeout(n.connectTimer),n.connectTimer=-1;var t=p.jid,i=p.xmppToken,r=p.web.option;null==(e=n.zConnection)||e.connect(t,i,r,[],"",n.onZStropheStatusChange)},this.doReconnect=function(){n.reconnectAttempts=n.reconnectAttempts+1,n.uninit(),n.init(),n.doConnect()},this.disconnect=function(e){P.debug("disconnect","disconnect by demand"),n.canReconnect=!1,self.clearTimeout(n.connectTimer),n.doDisconnect(e),n.uninit()},this.doDisconnect=function(e){n.stopPing();try{var t;null==(t=n.zConnection)||t.disconnect(e)}catch(e){P.debug("error when disconnect",e)}},this.onZStropheStatusChange=function(e,i){var r=R[e],o=i;P.debug("connection","status changed",n.statusInfo.status," -> ",r),r===t.WebimStatus.CONNECTING&&n.statusInfo.status!==t.WebimStatus.INIT&&(r=t.WebimStatus.RECONNECTING),r===t.WebimStatus.CONNECTED&&(n.secret=i.secret,n.syncTime={serverTime:i.serverTime,localTime:Date.now()},n.startPing(),n.reconnectAttempts=0,n.canReconnect=!0,self.clearTimeout(n.connectTimer),n.connectTimer=-1),r===t.WebimStatus.AUTHFAIL&&(n.canReconnect=!1),r===t.WebimStatus.ERROR&&(o!==t.WebimStatusErrorType.CONFLICT&&o!==t.WebimStatusErrorType.REVOKE_TOKEN||(n.canReconnect=!1)),n.statusInfo.status=r,n.statusInfo.statusInfo=o,Object.values(n.moduleMap).forEach((function(e){return e.onConnectionChange(n.statusInfo)})),n.dispatch({type:t.WebimEventType.ConnectionStatusChange,data:a({},n.statusInfo)}),r===t.WebimStatus.DISCONNECTED&&n.tryReconnect()},this.onNetworkChange=function(){var e=navigator.onLine;n.statusInfo.networkConnected=e,n.dispatch({type:t.WebimEventType.ConnectionStatusChange,data:a({},n.statusInfo)}),P.debug("connection -> network","network is",e?"on":"off"),e&&(n.zConnection?n.doDisconnect("network resumes"):n.tryReconnect())},this.startPing=function(){var e;n.stopPing(),n.doPing(),n.pingErrorTimes=0,n.stanzaHandler=null==(e=n.zConnection)?void 0:e.addHandler(n.onReceiveStanza,null,null,null),P.debug("ping start")},this.stopPing=function(){try{var e;null==(e=n.zConnection)||e.deleteHandler(n.stanzaHandler)}catch(e){}clearTimeout(n.pingTimer),n.pingTimer=-1,P.debug("ping stop")},this.doPing=function(){var e,t=p.PINGServer,i=p.pingTimeout,r=p.pingInterval;null==(e=n.zConnection)||e.ping.ping(t,n.pingSuccess,n.pingError,i),n.pingTimer=self.setTimeout(n.doPing,r)},this.pingError=function(){n.pingErrorTimes=n.pingErrorTimes+1,P.debug("ping error or timeout",n.pingErrorTimes),n.pingErrorTimes>=n.pingErrorMaxTimes&&(P.debug(" ping failed, may need to reconnect"),n.doDisconnect("ping count exceeds"))},this.pingSuccess=function(){n.pingErrorTimes=0},this.onReceiveStanza=function(){return n.pingSuccess(),!0},this.dispatch=i,this.secret="",this.syncTime={serverTime:-1,localTime:-1},this.deviceName=r;var o={connection:this,dispatch:i};this.moduleMap={roster:new M(o),vcard:new D(o),presence:new C(o),message:new x(o),room:new L(o)},this.init()}var n,i,r=e.prototype;return r.init=function(){P.debug("connection init");var e=p.XMPPServer;f.Resource=d.pwa,f.Config={ConferenceDomain:""},f.showLog=!1,this.zConnection=new f.Connection(e,{deviceName:this.deviceName}),P.debug("construct a new zStrophe.Connection"),self.addEventListener("online",this.onNetworkChange),self.addEventListener("offline",this.onNetworkChange),Object.values(this.moduleMap).forEach((function(e){return e.init()}))},r.uninit=function(){P.debug("connection uninit"),Object.values(this.moduleMap).forEach((function(e){return e.uninit()})),self.removeEventListener("online",this.onNetworkChange),self.removeEventListener("offline",this.onNetworkChange),this.zConnection&&(this.zConnection.connect_callback=null),this.zConnection=null},r.getCurrentStatusInfo=function(){return Object.assign({},this.statusInfo)},r.tryReconnect=function(){if(-1===this.connectTimer){if(!(this.canReconnect&&this.reconnectAttempts<p.maxReconnectAttempt))return this.statusInfo.willReconnect=!1,void P.debug("try reconnect","can not reconnect");if(this.statusInfo.networkConnected){var e=p.reconectIntervalMultiplier,t=p.reconnectInterval*Math.pow(e,this.reconnectAttempts);this.connectTimer=self.setTimeout(this.doReconnect,t),P.debug("try reconnect","schedule a task to reconnect in",t,"ms")}else P.debug("try reconnect","network is off. waiting for network")}else P.debug("try reconnect","already schedule a task to reconnect")},n=e,(i=[{key:"isConnected",get:function(){return this.statusInfo.status===t.WebimStatus.CONNECTED}},{key:"isDisconnected",get:function(){return this.statusInfo.status===t.WebimStatus.DISCONNECTED}}])&&s(n.prototype,i),e}(),j=new g(t.WebimModuleName.xms),B=function(e){var t=this,n=e.tokenUrl,i=e.secret;this.tokenUrl="",this.secret="",this.zckToken="",this.refreshTokenPromise=null,this.setSecret=function(e){t.secret=e},this.fetchToken=function(e){return t.tokenUrl?window.fetch(t.tokenUrl,{method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},body:"type=xms"}).catch((function(){return Promise.reject({errorCode:-1,errorMsg:"Network Error"})})).then((function(e){return e.ok?e.json():Promise.reject({errorCode:e.status,errorMsg:e.statusText})})).then((function(e){var t=e.errorCode,n=e.result;return 201===t?Promise.reject({errorCode:201,errorMsg:o}):0===t&&null!=n&&n.xmsPWAZCK?n.xmsPWAZCK:Promise.reject({errorCode:t,errorMsg:e.errorMsg||JSON.stringify(e)})})).then((function(e){t.zckToken=e})).catch((function(e){throw j.error("getXMSToken error ==>",e),t.zckToken="",e})):Promise.reject(new Error("tokenUrl is empty"))},this.refreshToken=function(e){return t.refreshTokenPromise||(t.refreshTokenPromise=t.fetchToken(e)),t.refreshTokenPromise.finally((function(){t.refreshTokenPromise=null}))},this.handleResponseOk=function(e){return e.ok&&200===e.status?Promise.resolve(e.json()):Promise.reject(e)},this.handleResponseFail=function(e){return e?e.ok?Promise.reject({errorCode:e.status,errorMsg:JSON.stringify(e.json())}):Promise.reject({errorCode:e.status,errorMsg:e.statusText}):Promise.reject({errorCode:-1,errorMsg:"Network Error"})},this.fetch=function(e,n){if(!t.secret)return Promise.reject("empty secret");var i=function(){var i,r,o,s,a,c,u=(i=n.body,r=t.zckToken,o=t.secret,a="timestamp="+(s=Date.now()).toString()+":"+JSON.stringify(i),c=f.hmacSHA256(a,o),{zck:r,"XMS-Timestamp":s,"XMS-Hash":f.Base64.stringify(c)}),l={method:n.method||"post",headers:Object.assign({"Content-Type":"application/json;charset=UTF-8"},n.headers,u),body:JSON.stringify(n.body)};return window.fetch(e,l).then(t.handleResponseOk).catch(t.handleResponseFail)};return!t.zckToken||t.refreshTokenPromise?t.refreshToken().then((function(){return i()})):i().catch((function(e){if(490===e.errorCode)return t.refreshToken().then((function(){return i()}));throw e}))},this.tokenUrl=n,this.secret=i,this.refreshTokenPromise=null},F=new g(t.WebimModuleName.xms),z=function(e){var t=this,n=e.tokenUrl,i=e.secret,r=e.xmsDomain;this.vcardsMap=new Map,this.httpRequest=void 0,this.xmsDomain="",this.filterJidIfDataCache=function(e,n){return e.filter((function(e){var i=e.jid,r=t.vcardsMap.get(i);if(!r)return!0;var o=p.queryVcardInterval,s=r.lastQueryTime;return!!(Date.now()-s>=o||n)}))},this.fetchContactProfile=function(e){var n=e.jidParams,i=e.forceFetch,r=void 0!==i&&i,o=n.jids,s=t.filterJidIfDataCache(o,r);if(0===s.length)return F.debug("vcardsMap has cached, need not request"),Promise.resolve([]);F.debug("filter forceFetch ==>",r),F.debug("filter queryJids ==>",s);var c={body:{jids:s}};return t.httpRequest.fetch("https://"+t.xmsDomain+"/xms/vcard/fetch",c).then((function(e){F.debug("fetchContactProfile result ==>",e);var n=e.data;return n&&Array.isArray(n)?n.map((function(e){var n=e.vcard,i=e.jid;return i&&t.vcardsMap.set(i,a({},e,{lastQueryTime:Date.now()})),a({},e,{vcard:n&&f.formatVcard(n)||{}})})):Promise.reject(JSON.stringify(e))})).catch((function(e){throw e}))},this.checkMemberIsInGroup=function(e){var n={body:e};return t.httpRequest.fetch("https://"+t.xmsDomain+"/xms/channel/memberIsInGroup",n).then((function(e){F.debug("checkMemberIsInGroup result ==>",e);var t=e.data;return t&&Array.isArray(t)?t:Promise.reject(JSON.stringify(e))})).catch((function(e){throw e}))},this.fetchRecentChats=function(){return t.httpRequest.fetch("https://"+t.xmsDomain+"/xms/channel/recentChats",{body:{}}).then((function(e){return F.debug("fetchRecentChats result ==>",e),e.data||Promise.reject(JSON.stringify(e))})).catch((function(e){throw e}))},this.checkAlreadyContact=function(e){var n={body:e};return t.httpRequest.fetch("https://"+t.xmsDomain+"/xms/vcard/fetch/byEmail",n).then((function(e){F.debug("checkAlreadyContact response ==>",e);var t=e.result,n=e.data;return 0===t&&Array.isArray(n)&&n.length>0?n.map((function(e){return a({},e,{vcard:f.formatVcard(e.vcard)})})):Promise.reject(JSON.stringify(e))})).catch((function(e){throw e}))},this.xmsDomain=r,this.httpRequest=new B({tokenUrl:n,secret:i})};t.WEB_SESSION_EXPIRED_ERROR=o,t.default=function(e){var n,i;Object.assign(p,e),g.setLogLevels(null==(n=p.log)?void 0:n.logLevel),g.setLogModules(null==(i=p.log)?void 0:i.logModule);var r,o={all:r=r||new Map,on:function(e,t){var n=r.get(e);n&&n.push(t)||r.set(e,[t])},off:function(e,t){var n=r.get(e);n&&n.splice(n.indexOf(t)>>>0,1)},emit:function(e,t){(r.get(e)||[]).slice().map((function(e){e(t)})),(r.get("*")||[]).slice().map((function(n){n(e,t)}))}},s=function(e,t,n){return new Promise((function(i,r){var o=e.isConnected,s=e.secret;if(!o||!s)return r("ERROR:: connection isConnected: "+e.isConnected+", connection secret: "+e.secret);var a=t.PWATokenUrl,c=t.XMSDomain;return a&&c?(n.httpRequest.secret||n.httpRequest.setSecret(s),i(!0)):r("ERROR:: PWATokenUrl: "+a+", XMSDomain: "+c)}))},a=new H({dispatch:function(e){e.type,t.WebimEventType.GroupChange,e.type,t.WebimEventType.PresenceChange,e.type,t.WebimEventType.VcardChange,e.type,t.WebimEventType.MessageChange,o.emit(e.type,e)},deviceName:null==e?void 0:e.deviceName}),c=a.moduleMap,u=c.vcard,l=c.presence,d=c.message,h=c.roster,m=c.room,f=new z({tokenUrl:p.PWATokenUrl,secret:a.secret,xmsDomain:p.XMSDomain});return{on:function(e,t){o.on(e,t)},off:function(e,t){o.off(e,t)},clear:function(){o.all.clear()},getCurrentStatus:function(){return a.getCurrentStatusInfo().status},connect:function(e){Object.assign(p,e),a.connect()},disconnect:function(e){a.disconnect(e)},queryPresence:function(e){return a.isConnected?l.queryPresence(e):null},changePresence:function(e,t,n){return void 0===t&&(t=!1),a.isConnected?l.changePresence(e,t,n):null},duration:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return a.isConnected?l.duration(e):null})),queryVcard:function(e){return a.isConnected?u.queryVcard(e):null},invite:function(e){return a.isConnected?d.invite(e):null},cancelInvitation:function(e){return a.isConnected?d.cancelInvitation(e):null},declineInvitation:function(e){return a.isConnected?d.declineInvitation(e):null},acceptInvitation:function(e){return a.isConnected?d.acceptInvitation(e):null},queryRecentChat:function(){return a.isConnected?d.queryRecentChat():null},getGroupMembers:function(e){return a.isConnected?h.queryGroupMember(e):null},getContactProfile:function(t){return s(a,e,f).then((function(){return f.fetchContactProfile(t)})).catch((function(e){return Promise.reject(e)}))},checkMemberIsInGroup:function(t){return s(a,e,f).then((function(){return f.checkMemberIsInGroup(t)})).catch((function(e){return Promise.reject(e)}))},getRecentChats:function(){return s(a,e,f).then((function(){return f.fetchRecentChats()})).catch((function(e){return Promise.reject(e)}))},unhideRoom:function(e){return a.isConnected?m.unhideRoom(e):Promise.reject("disconnected")},fetchBlockList:function(){return h.fetchBlockList()},queryDevices:function(){return a.isConnected?l.queryDevice():null},requestLcp:function(e,t,n,i,r){var o;return a.isConnected?null==a||null==(o=a.zConnection)?void 0:o.Messaging.requestLcp(e,t,n,i,r):null},inviteContactByEmail:function(e){return l.inviteContactByEmail(e)},deleteContactByJid:function(e){return l.deleteContactByJid(e)},sendInviteContactSyncMessage:function(e){return a.isConnected?d.sendInviteContactSyncMessage(e):null},checkAlreadyContact:function(t){return s(a,e,f).then((function(){return f.checkAlreadyContact(t)})).catch((function(e){return Promise.reject(e)}))},sendLcp:function(e,t,n,i,r,o){var s;return a.isConnected?null==a||null==(s=a.zConnection)?void 0:s.Messaging.sendLcp(e,t,n,i,r,o):null}}},Object.defineProperty(t,"__esModule",{value:!0})}(t)}).call(this,n(94))}}]);